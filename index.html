<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8">
    
    <title>lucasmatt.com</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta property="og:type" content="website">
<meta property="og:title" content="lucasmatt.com">
<meta property="og:url" content="http://lucasmatt.com/index.html">
<meta property="og:site_name" content="lucasmatt.com">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="lucasmatt.com">
<meta name="twitter:creator" content="@notmattlucas">
<link rel="publisher" href="lucas1000001">
    

    
        <link rel="alternate" href="/rss2.xml" title="lucasmatt.com" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome5/css/fontawesome.min.css">
    <link rel="stylesheet" href="/libs/font-awesome5/css/fa-brands.min.css">
    <link rel="stylesheet" href="/libs/font-awesome5/css/fa-solid.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-17281106-1', 'auto');
ga('send', 'pageview');

</script>
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                
                <span class="site-title">lucasmatt.com</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/images/avatar.jpg" />
                            <i class="fas fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fas fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile" class="profile-fixed">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/images/avatar.jpg" />
            <h2 id="name">Matthew Lucas</h2>
            <h3 id="title">Software Developer &amp; General Nerd</h3>
            <span id="location"><i class="fas fa-map-marker-alt" style="padding-right: 5px"></i>Cardiff, UK</span>
            <a id="follow" target="_blank" href="https://github.com/lucas-matt/">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                12
                <span>posts</span>
            </div>
            <div class="article-info-block">
                20
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/lucas-matt" target="_blank" title="github" class=tooltip>
                            <i class="fab fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="http://twitter.com/notmattlucas" target="_blank" title="twitter" class=tooltip>
                            <i class="fab fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/rss2.xml" target="_blank" title="rss" class=tooltip>
                            <i class="fab fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-testing-nightmares" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/03/13/testing-nightmares/">6(66) Nightmares of Microservice Testing</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2018/03/13/testing-nightmares/">
            <time datetime="2018-03-13T19:35:18.000Z" itemprop="datePublished">2018-03-13</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/Testing/">Testing</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/microservices/">microservices</a>, <a class="tag-link" href="/tags/testing/">testing</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/images/nightmare.jpg" alt=""></p>
<div style="text-align: right"><sub><sup><a href="https://www.flickr.com/photos/ollierb/14572262390/" target="_blank" rel="noopener">“The Stuff of nightmares”</a> (<a href="https://creativecommons.org/licenses/by-nc-nd/2.0/" target="_blank" rel="noopener">CC BY-NC-ND 2.0</a>) by <a href="https://www.flickr.com/people/ollierb/" target="_blank" rel="noopener">ollierb</a></sup></sub></div>

<p>Tests are clearly an extremely important port of a developer’s day-to-day. They provide us with a safety net as we hack away at the rotten roots of our codebase, allowing us to feel more like a real engineer and less like we’re walking through an antiques shop wearing a 12th century suit of armour.</p>
<p>But as Dante said - there’s a special place in hell for evil-doing programmers, where the tests run ever so slowly, constantly flap and the coffee never ever brews! - or at least I’m pretty sure that’s what Inferno describes having never actually read it. In reality, we’ve all glimpsed this hell and its myriad mini tortures …</p>
<h2 id="i-Distributed-monolith"><a href="#i-Distributed-monolith" class="headerlink" title="i) Distributed monolith"></a>i) Distributed monolith</h2><p>One of the most fundamental principles of a microservice architecture is <em>independent deployment</em>. There are numerous benefits that result from this, but at the most basic level it’s about simplification, speed and tiny increments.</p>
<p>So why - then - do we often insist on testing our whole suite of services in one huge gulp!</p>
<p>If you have to manage every single moving part in one massive test deployment then you no longer have a set of microservices but rather a painfully distributed monolith. Needless to say, this is going to be extremely difficult to consistent spin up, debug and develop for. Any activity at this level should really be kept to the few smoke or end-to-end tests that can verify your system.</p>
<p>Contract testing frameworks, such as <a href="http://pact.io" target="_blank" rel="noopener">pact</a>, can be a saviour here.</p>
<h2 id="ii-Tending-to-special-unicorns"><a href="#ii-Tending-to-special-unicorns" class="headerlink" title="ii) Tending to special unicorns"></a>ii) Tending to special unicorns</h2><p>Tests of any category should be simple to check-out, kick-off and develop/debug. However, far too often, it can involve a Herculeon effort of trial and error just to get the damn things running in the first place.</p>
<p>Wrestling with pages of undocumented configuration, rivaling the bulk of War &amp; Peace, can make you want to quit before you’ve even begun.</p>
<p>Machines that need some special pampering and preening before they even think about playing ball inevitably result in a team fearful of touching ‘the sacred server’ in case they piss off the testing gods.</p>
<p>Those that cannot be easily executed from a development environment are doomed to a future of bit rot and ever increasing padding with inventive variations on “sleep(1000)” to get the build to “please just go green again!”</p>
<p>A consistent way to deploy and control a deployment is the antidote here. Tooling such as <a href="http://arquillian.org/" target="_blank" rel="noopener">arquillian</a> can given Java developers that piece of mind. Or alternatively, if you’re able to encapsulate that “specialness” within a docker container you can use docker-compose (and friends) to orchestrate in a consistent way and move your tests in the right direction.</p>
<h2 id="iii-Too-much-tea"><a href="#iii-Too-much-tea" class="headerlink" title="iii) Too much tea"></a>iii) Too much tea</h2><p>If, more often than not, when you run your tests you have enough time to make a(nother) cup of tea then there’s a bit of an issue. Slow tests mean a far longer feedback loop, less pace and more importantly loss of focus.</p>
<p>It’s understandable that for a certain small class of test - those that run end-to-end - will take their fair share of time. But every effort should be made to keep the bulk of your tests running lightening quick.</p>
<p>The greatest crime of all is using those dreaded blocking waits to control flow within a test. These stack up <em>really</em> quickly and breed even faster - one sleep usually leads to enough instability to require a number of peers. Tests should be strictly event driven, reacting directly to triggers in the system under test.</p>
<h2 id="iv-An-unbalanced-portfolio"><a href="#iv-An-unbalanced-portfolio" class="headerlink" title="iv) An unbalanced portfolio"></a>iv) An unbalanced portfolio</h2><p>We’re all aware of the sacred ‘test pyramid’ demonstrating the range of tests from fast and cheap to slow and costly. There are many variations on this metaphor these days, but they are all based on the same principle: cover as much of your functionality using the lower levels of the pyramid and only extend further up the structure as needed to cover the rest.</p>
<p>Avoid covering functionality in your heavier testing layers when it can be taken care of by the simpler and snappier ones.</p>
<h2 id="v-Testing-in-paradise"><a href="#v-Testing-in-paradise" class="headerlink" title="v) Testing in paradise"></a>v) Testing in paradise</h2><p>Little in life is ever certain. However, although in the old monolith world you couldn’t ever be completely confident in each and every action, you could be fairly sure a call between one module and another was pretty much guaranteed.</p>
<p>In the distributed systems domain of microservices very little is certain. If your system has a large enough footprint it is almost never going to 100% healthy. It’s foolish to test and not take this into account, or to at least not mitigate these issues via more modern chaos engineering strategies.</p>
<p>Tools to check out in this space would include <a href="https://github.com/tomakehurst/saboteur" target="_blank" rel="noopener">saboteur</a>, <a href="https://hoverfly.io/" target="_blank" rel="noopener">hoverfly</a> and <a href="https://github.com/Netflix/SimianArmy/wiki" target="_blank" rel="noopener">simian army</a> .</p>
<h2 id="vi-Thinking-that-testing-ends-when-you-ship-code"><a href="#vi-Thinking-that-testing-ends-when-you-ship-code" class="headerlink" title="vi) Thinking that testing ends when you ship code"></a>vi) Thinking that testing ends when you ship code</h2><p>Traditional testing strategy is very much focussed on ‘the product’. You design it, develop it, run a whole bunch of tests (hopefully automated) before burning it on a disc and kicking it out the door.</p>
<p>Can’t we take the same approach with a microservice deployment? Well many have certainly tried and inevitably struggled to make it succeed. The inherent complexity in a more advanced distributed system makes catering for every eventuality an enormous task that quickly becomes insurmountable. </p>
<p>By throwing in the towel and stepping back it becomes clearer that testing is really a probability game. We want to get a near to 100% coverage as we can without spending all our resource on getting there.</p>
<p>A smarter investment may be to pick up much of low hanging fruit when it comes to traditional testing, and then investing the rest in improving our QA in production ability. Strategies such as:</p>
<ul>
<li><a href="https://octopus.com/docs/deployment-patterns/canary-deployments" target="_blank" rel="noopener"><strong>canary deployments</strong></a> - routing a small selection of users onto a fresh deployment to check its stability.</li>
<li><a href="http://blog.christianposta.com/microservices/advanced-traffic-shadowing-patterns-for-microservices-with-istio-service-mesh/" target="_blank" rel="noopener"><strong>shadowing</strong></a> - duplicating traffic from the live environment onto a new deployment, and comparing the results to assert correctness.</li>
</ul>
<p>This clearly comes with a certain amount of maturity within the services themselves. You cannot go about deploying potentially breaking changes into production without an ability to roll back easily, gracefully degrade and to provide alternatives/fallbacks in the case of an issue.</p>
<p>Definitely a goal worth pursuing.</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://lucasmatt.com/2018/03/13/testing-nightmares/" data-id="cjhz4jghu000sg5r1y6o3o9qt" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://lucasmatt.com/2018/03/13/testing-nightmares/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://lucasmatt.com/2018/03/13/testing-nightmares/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-bits-2017-02-18" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/02/17/bits-2017-02-18/">[Bits 1] Year of the Dog</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2018/02/17/bits-2017-02-18/">
            <time datetime="2018-02-17T00:00:00.000Z" itemprop="datePublished">2018-02-17</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/bits/">bits</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/bits/">bits</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/images/flat_bits.jpg" alt=""></p>
<hr>
<h4 id="Happy-new-year-…-again"><a href="#Happy-new-year-…-again" class="headerlink" title="Happy new year! … again"></a>Happy new year! … again</h4><p>As I seem to only post blog entries at the start of a fresh year, here’s the first of what I hope will become a fairly frequent round-up of articles, books etc that I’ve found particularly interesting during the preceding week or so.</p>
<p>If all goes to plan then maybe I’ll get my next post out before the Mayan calendar flips over in July.</p>
<hr>
<h2 id="Articles"><a href="#Articles" class="headerlink" title="Articles"></a>Articles</h2><h4 id="Introducing-capsule-networks"><a href="#Introducing-capsule-networks" class="headerlink" title="Introducing capsule networks"></a><a href="https://www.oreilly.com/ideas/introducing-capsule-networks" target="_blank" rel="noopener">Introducing capsule networks</a></h4><p>A brief, and understandable, overview of a new neural network architecture from the godfather of deep learning <a href="https://en.wikipedia.org/wiki/Geoffrey_Hinton" target="_blank" rel="noopener">Geoffrey Hinton</a>.</p>
<h4 id="Lessons-from-optics-the-other-deep-learning"><a href="#Lessons-from-optics-the-other-deep-learning" class="headerlink" title="Lessons from optics, the other deep learning"></a><a href="http://www.argmin.net/2018/01/25/optics/" target="_blank" rel="noopener">Lessons from optics, the other deep learning</a></h4><p>A case for making deep learning more intuitive and approachable by comparing its layered nature to that of the field of optics.</p>
<h4 id="How-neural-networks-learn-distributed-representations"><a href="#How-neural-networks-learn-distributed-representations" class="headerlink" title="How neural networks learn distributed representations"></a><a href="https://www.oreilly.com/ideas/how-neural-networks-learn-distributed-representations" target="_blank" rel="noopener">How neural networks learn distributed representations</a></h4><p>An intuition for how a deep learning net can capture representations and models across its distributed parts.</p>
<h4 id="Game-theory-insights-into-asymmetric-multi-agent-games-DeepMind"><a href="#Game-theory-insights-into-asymmetric-multi-agent-games-DeepMind" class="headerlink" title="Game-theory insights into asymmetric multi-agent games | DeepMind"></a><a href="https://deepmind.com/blog/game-theory-insights-asymmetric-multi-agent-games/" target="_blank" rel="noopener">Game-theory insights into asymmetric multi-agent games | DeepMind</a></h4><p>From the masters of reinforcement learning and AI game playing (<a href="https://deepmind.com/" target="_blank" rel="noopener">DeepMind</a>) comes a technique to quickly and easily identify the Nash equilibrium of an asymmetric multi-agent game.</p>
<h4 id="Quantum-computers-‘one-step-closer’"><a href="#Quantum-computers-‘one-step-closer’" class="headerlink" title="Quantum computers ‘one step closer’"></a><a href="http://www.bbc.co.uk/news/science-environment-43065485" target="_blank" rel="noopener">Quantum computers ‘one step closer’</a></h4><p>BBC article on some recent developments in the field of quantum computing.</p>
<h4 id="Why-the-Web-3-0-matters-and-what-you-should-know-about-it"><a href="#Why-the-Web-3-0-matters-and-what-you-should-know-about-it" class="headerlink" title="Why the Web 3.0 matters and what you should know about it"></a><a href="https://medium.com/@matteozago/why-the-web-3-0-matters-and-you-should-know-about-it-a5851d63c949" target="_blank" rel="noopener">Why the Web 3.0 matters and what you should know about it</a></h4><p>Data privacy and governance are increasingly important topics in today’s world. Web 3.0 - the decentralized web - is approaching fast, thanks mainly to blockchain. This post brings you up to speed on many of the areas of our lives this may have the power to affect.</p>
<hr>
<h2 id="Books"><a href="#Books" class="headerlink" title="Books"></a>Books</h2><figure style="float: left; width: 25%;"><img src="/images/bits/1/Chollet-DLP-HI.png" alt=""></figure>

<h4 id="Deep-Learning-with-Python"><a href="#Deep-Learning-with-Python" class="headerlink" title="Deep Learning with Python"></a><a href="https://www.manning.com/books/deep-learning-with-python" target="_blank" rel="noopener">Deep Learning with Python</a></h4><p>A fantastic dive into the practical aspects of deep learning. The only real downside is that there’s such a wealth of information present that it’ll take a fair few iterations to fully absorb all of the content.</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://lucasmatt.com/2018/02/17/bits-2017-02-18/" data-id="cjhz4jghh000dg5r1tmnl3m8m" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://lucasmatt.com/2018/02/17/bits-2017-02-18/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://lucasmatt.com/2018/02/17/bits-2017-02-18/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-radar-jan-18" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/01/01/radar-jan-18/">Technology Radar Jan &#39;18</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2018/01/01/radar-jan-18/">
            <time datetime="2018-01-01T00:00:00.000Z" itemprop="datePublished">2018-01-01</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/Tech-Radar/">Tech Radar</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/growth/">growth</a>, <a class="tag-link" href="/tags/radar/">radar</a>, <a class="tag-link" href="/tags/thinking/">thinking</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/images/radar-jan-18/firework.jpg" alt=""></p>
<div style="text-align: right"><sub><sup><a href="https://www.flickr.com/photos/spi/3702243785/" target="_blank" rel="noopener">“Firework”</a> (<a href="https://creativecommons.org/licenses/by-sa/2.0/" target="_blank" rel="noopener">CC BY-SA 2.0</a>) by <a href="https://www.flickr.com/people/spi/" target="_blank" rel="noopener">spi516</a></sup></sub></div>

<p>The <a href="https://www.thoughtworks.com/radar" target="_blank" rel="noopener">Thoughtworks Technology Radar</a> should be a familiar sight to any active technologist. The breadth of coverage across hundreds of interesting technologies, both new and old, has made its release something of an event in the software developer’s calendar.</p>
<p>In an interesting <a href="https://www.thoughtworks.com/insights/blog/build-your-own-technology-radar" target="_blank" rel="noopener">post</a> by one of Thoughtworks key employees - Neal Ford - it is suggested that not only should enterprises produce their own version of the radar, but so should each individual software developer.</p>
<blockquote><p>You need two radars: one for yourself, to help guide your career decisions, and one for your company. </p>
<footer><strong>Build Your Own Technology Radar</strong><cite><a href="https://www.thoughtworks.com/insights/blog/build-your-own-technology-radar" target="_blank" rel="noopener">www.thoughtworks.com/insights/blog/build-your-own-technology-radar</a></cite></footer></blockquote>
<p>In an attempt capture the direction of my career and hobbyist efforts I have taken this advice and produced my first personal radar.</p>
<h1 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h1><p>First a quick overview of my “Intro to 2018” list, which seems to be split into three broad categories.</p>
<p><strong>Near Term Increments</strong><br>Items related to Java, microservices and containerization would fall under this category. Technologies that I use on a day to day basis, and in which I should be fairly fluent, whilst continuing to improve my understanding.</p>
<p><strong>Longer Term Investments</strong><br>Technologies that are more aspirational in scope - e.g. AI and machine learning topics - but are likely to become much more prevalent in the industry within the next 5 years or so.</p>
<p><strong>Skill Diversification</strong><br>Skills that would be considered a “parallel path” to my everyday, but of which I should have some decent appreciation of - even if only at a very basic level. For example, Android or Alexa development.</p>
<p>Now for the radar in full.</p>
<h1 id="Techniques-amp-Theory"><a href="#Techniques-amp-Theory" class="headerlink" title="Techniques &amp; Theory"></a>Techniques &amp; Theory</h1><p><img src="/images/radar-jan-18/techniques.png" alt=""></p>
<h3 id="Too-Many-Cucumbers"><a href="#Too-Many-Cucumbers" class="headerlink" title="Too Many Cucumbers!"></a>Too Many Cucumbers!</h3><p><strong>hold</strong></p>
<p>BDD, and Cucumber most specifically, are great tools when used in the right context. However having way too many tests, or generating unfocussed tests, can result in a slow, brittle and unmaintainable test suite. In addition to this, not having a key business stakeholder involved with the definition and understanding of the scenarios defeats the point somewhat. I’ll be personally looking to use this technique/tool more judiciously in future.</p>
<h3 id="Deep-Learning"><a href="#Deep-Learning" class="headerlink" title="Deep Learning"></a>Deep Learning</h3><p><strong>trial</strong></p>
<p>Deep learning, and related techniques, have made neural networks cool again! Not to jump on any kind of bandwagon, but I’ll be looking to further understand this class of algorithm more clearly, as I believe they will become much more prevalent in the daily life of a software developer in the upcoming decade and beyond.</p>
<h3 id="Service-Mesh"><a href="#Service-Mesh" class="headerlink" title="Service Mesh"></a>Service Mesh</h3><p><strong>assess</strong></p>
<p>A microservice architecture, although in the singular quite simple, in the aggregate can become quite an unmanagable behemoth. Managing communication, security, monitoring and other similar concerns that are orthogonal to the core business can form a significant part of this complex distributed system. Service meshes look to externalize and manage much of this trickery as a third part concern, allowing you to focus solely on what you do best.</p>
<h3 id="Chaos-Engineering"><a href="#Chaos-Engineering" class="headerlink" title="Chaos Engineering"></a>Chaos Engineering</h3><p><strong>assess</strong></p>
<p>If things can go wrong they usually will. Add to this fact that microservices up the surface area of things that can go wrong (specifically in between those services), then writing robust, resilient and scalable systems means we must probe at the corners of possibilities. A mature development team should be looking at chaos engineering practices to try and tease out any problematic edge cases before they occur in the wild.</p>
<h3 id="Lightweight-Architecture-Decision-Records"><a href="#Lightweight-Architecture-Decision-Records" class="headerlink" title="Lightweight Architecture Decision Records"></a>Lightweight Architecture Decision Records</h3><p><strong>assess</strong></p>
<p>Ever wonder why a decision was made or the context in which it was made. Lightweight architecture decision records are a technique for capturing those important decisions in a simple text format able to be kept in SCM alongside the sourcecode itself.</p>
<h3 id="Consumer-Driven-Contract-Testing"><a href="#Consumer-Driven-Contract-Testing" class="headerlink" title="Consumer Driven Contract Testing"></a>Consumer Driven Contract Testing</h3><p><strong>trial</strong></p>
<p>An essential part of the microservice testing toolkit. They enable independent service deployments whilst maintaining that solid contract between any two neighbouring services.</p>
<h3 id="Reinforcement-Learning"><a href="#Reinforcement-Learning" class="headerlink" title="Reinforcement Learning"></a>Reinforcement Learning</h3><p><strong>assess</strong></p>
<p>A relatively old machine learning technique that utilizes a feedback loop to train a software agent in a specific, realtime, environment. More recently, when combined with deep learning, has shown some very interesting applications - e.g. the famous Deep Mind Atari playing agents.</p>
<h3 id="Data-Structures-amp-Algorithms"><a href="#Data-Structures-amp-Algorithms" class="headerlink" title="Data Structures &amp; Algorithms"></a>Data Structures &amp; Algorithms</h3><p><strong>adopt</strong></p>
<p>As a software developer, unless you’re very lucky, you spend much of your time putting things into databases and then pulling them out again in the future to show to an end user. As you can imagine, this doesn’t involve a ton of good old Computer Science, and inevitably the knowledge of those core algorithms slowly diminishes. This is a “note to self” to visit some of those topics, and keep that knowledge fresh.</p>
<h3 id="Statistics"><a href="#Statistics" class="headerlink" title="Statistics"></a>Statistics</h3><p><strong>adopt</strong></p>
<p>The continued rise of machine learning and data science require a good understanding of statistical methods and similar such topics. This is likely to become even more true as the field expands into every day software development.</p>
<h3 id="Linear-Algebra"><a href="#Linear-Algebra" class="headerlink" title="Linear Algebra"></a>Linear Algebra</h3><p><strong>adopt</strong></p>
<p>Machine learning algorithms are very much based upon core linear algebra concepts. To truely understand the magic inside some of those algorithms, a good understand of linear algebra is essential.</p>
<h3 id="Domain-Driven-Design"><a href="#Domain-Driven-Design" class="headerlink" title="Domain Driven Design"></a>Domain Driven Design</h3><p><strong>adopt</strong></p>
<p>Designing microservices that are internally cohesive but well decoupled can be quite a challenge to impllement, as anyone who has worked on such a system will understand. An understanding of DDD is key to to ensure that the right design decisions are made.</p>
<h1 id="Tools-amp-Frameworks"><a href="#Tools-amp-Frameworks" class="headerlink" title="Tools &amp; Frameworks"></a>Tools &amp; Frameworks</h1><p><img src="/images/radar-jan-18/tools.png" alt=""></p>
<h3 id="Tensorflow"><a href="#Tensorflow" class="headerlink" title="Tensorflow"></a>Tensorflow</h3><p><strong>trial</strong></p>
<p>TensorFlow is an open-source software library for dataflow programming across a range of tasks. It is a symbolic math library, and also used for machine learning applications such as neural networks.</p>
<h3 id="Scikit-Learn"><a href="#Scikit-Learn" class="headerlink" title="Scikit Learn"></a>Scikit Learn</h3><p><strong>trial</strong></p>
<p>Scikit-learn is a free software machine learning library. It features various classification, regression and clustering algorithms including support vector machines, random forests, gradient boosting, k-means and DBSCAN, and is designed to interoperate with the Python numerical and scientific libraries NumPy and SciPy.</p>
<h3 id="Keras"><a href="#Keras" class="headerlink" title="Keras"></a>Keras</h3><p><strong>assess</strong></p>
<p>Keras is a high-level interface in Python for building neural networks. Keras is open source and runs on top of either TensorFlow or Theano. It provides an amazingly simple interface for creating powerful deep-learning algorithms to train on CPUs or GPUs</p>
<h3 id="Jupyter"><a href="#Jupyter" class="headerlink" title="Jupyter"></a>Jupyter</h3><p><strong>adopt</strong></p>
<p>Increased interest in machine learning — along with the emergence of Python as the programming language of choice for practitioners in this field — has focused particular attention on Python notebooks, and the most popular of these is Jupyter.</p>
<h3 id="Open-Tracing"><a href="#Open-Tracing" class="headerlink" title="Open Tracing"></a>Open Tracing</h3><p><strong>assess</strong></p>
<p>A vendor-neutral open standard for distributed tracing</p>
<h3 id="Apache-Spark"><a href="#Apache-Spark" class="headerlink" title="Apache Spark"></a>Apache Spark</h3><p><strong>hold</strong></p>
<p>Apache Spark™ is a fast and general engine for large-scale data processing. Although still an excellen tool in the right circumstance, I’ve decided to focus my attention on learning less large-scale data science frameworks.</p>
<h3 id="Pandas"><a href="#Pandas" class="headerlink" title="Pandas"></a>Pandas</h3><p><strong>adopt</strong></p>
<p>pandas is an open source library providing high-performance, easy-to-use data structures and data analysis tools for the Python programming language.</p>
<h3 id="Numpy"><a href="#Numpy" class="headerlink" title="Numpy"></a>Numpy</h3><p><strong>adopt</strong></p>
<p>NumPy is the fundamental package for scientific computing with Python.</p>
<h1 id="Platforms"><a href="#Platforms" class="headerlink" title="Platforms"></a>Platforms</h1><p><img src="/images/radar-jan-18/platforms.png" alt=""></p>
<h3 id="AWS"><a href="#AWS" class="headerlink" title="AWS"></a>AWS</h3><p><strong>adopt</strong></p>
<p>Clearly AWS isn’t anything new, but I’ve personally neglected getting more involved with the platform for way too long. Here’s a “note to self” to dig in and understand it a little more.</p>
<h3 id="Serverless"><a href="#Serverless" class="headerlink" title="Serverless"></a>Serverless</h3><p><strong>trial</strong></p>
<p>The use of serverless architecture has very quickly become an accepted approach for organizations deploying cloud applications, with a plethora of choices available for deployment.</p>
<h3 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h3><p><strong>trial</strong></p>
<p>In a similar vein to my AWS entry, Android (or mobile development in general) should be understood at a basic level by any mature software developer - another todo for personal projects. </p>
<h3 id="Alexa"><a href="#Alexa" class="headerlink" title="Alexa"></a>Alexa</h3><p><strong>trial</strong></p>
<p>Voice platforms are high in popularity at the moment. Whether a fad, or real trend, it’s worth getting stuck in to a personal project on the Alexa platform for some diversification of skills.</p>
<h3 id="Sage-Maker"><a href="#Sage-Maker" class="headerlink" title="Sage Maker"></a>Sage Maker</h3><p><strong>assess</strong></p>
<p>Amazon SageMaker is a fully-managed service that enables developers and data scientists to quickly and easily build, train, and deploy machine learning models at any scale. Amazon SageMaker removes all the barriers that typically slow down developers who want to use machine learning.</p>
<h3 id="Kaggle"><a href="#Kaggle" class="headerlink" title="Kaggle"></a>Kaggle</h3><p><strong>adopt</strong></p>
<p>Kaggle is a platform for predictive modelling and analytics competitions in which statisticians and data miners compete to produce the best models for predicting and describing the datasets uploaded by companies and users.</p>
<h3 id="Kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes</h3><p><strong>adopt</strong></p>
<p>Kubernetes is an open-source system for automating deployment, scaling, and management of containerized applications.</p>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p><strong>adopt</strong></p>
<p>Docker is the world’s leading containerization platform - not much to add myself, just that it’s currenlty a must have for serverside development.</p>
<h1 id="Languages"><a href="#Languages" class="headerlink" title="Languages"></a>Languages</h1><p><img src="/images/radar-jan-18/languages.png" alt=""></p>
<h3 id="Kotlin"><a href="#Kotlin" class="headerlink" title="Kotlin"></a>Kotlin</h3><p><strong>trial</strong></p>
<p>Kotlin is a statically typed programming language for modern multiplatform applications. It has overtaken Scala as my personal JVM alt-language of interest, and I’m looking to play with it a fair bit more this year.</p>
<h3 id="Python-2"><a href="#Python-2" class="headerlink" title="Python 2"></a>Python 2</h3><p><strong>hold</strong></p>
<p>Python 2 has been king for as long as I can remember, but with Python 3 getting some great new features and wider community support, it has finally come time for its abdication.</p>
<h3 id="Python-3"><a href="#Python-3" class="headerlink" title="Python 3"></a>Python 3</h3><p><strong>adopt</strong></p>
<p>See Python 2</p>
<h3 id="Scala"><a href="#Scala" class="headerlink" title="Scala"></a>Scala</h3><p><strong>hold</strong></p>
<p>For many years after my initial Clojure obession I saw Scala as my functional saviour from a frustrating and verbose Java. Despite many fun times with the language, its inherent complexity and (seeming) drop off in adoption have lead me to consider the growing alternatives - see Kotlin.</p>
<h3 id="R"><a href="#R" class="headerlink" title="R"></a>R</h3><p><strong>hold</strong></p>
<p>A great data science and machine learning language. However, my larger personal experience with Python, and Python’s continued dominence in the data science community, have led me to trim down my options and focus on a deeper rather than broader personal research.</p>
<h3 id="Effective-Java-8-9"><a href="#Effective-Java-8-9" class="headerlink" title="Effective Java 8/9"></a>Effective Java 8/9</h3><p><strong>adopt</strong></p>
<p>Java has (fairly) recently obtained some significant improves to the core language. However, as with everything, addition adds complexity. Some best practices around these features is key, and where better to study and in Joshua Bloch’s revised book.</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://lucasmatt.com/2018/01/01/radar-jan-18/" data-id="cjhz4jghq000ng5r1cdzksta5" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://lucasmatt.com/2018/01/01/radar-jan-18/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://lucasmatt.com/2018/01/01/radar-jan-18/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-spring-microservices" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/08/22/spring-microservices/">Spring Cloud in 10 Bad Cartoons</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2017/08/22/spring-microservices/">
            <time datetime="2017-08-22T00:00:00.000Z" itemprop="datePublished">2017-08-22</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/Programming/">Programming</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/java/">java</a>, <a class="tag-link" href="/tags/microservices/">microservices</a>, <a class="tag-link" href="/tags/spring/">spring</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/images/spring-microservices/spring.jpg" alt=""></p>
<p><em>A quick tour of the combined Spring Cloud / Netflix OSS microservice stack through some pretty terrible drawings, inspired by John Carnell’s book <a href="https://www.manning.com/books/spring-microservices-in-action" target="_blank" rel="noopener">Spring Microservices in Action</a> (the subject, that is, not the awful pictures)</em></p>
<hr>
<p>Building well designed applications using microservices can require a great deal of maturity. Aspects such as service discovery, load balancing and gracefully handling failure are effectively mandatory, but can be painful to implement well.</p>
<p><a href="http://projects.spring.io/spring-cloud/" target="_blank" rel="noopener">Spring Cloud</a> pulls together a number of well worn tools that help make a number of the core patterns of distributed systems simpler to wire up and manage. More specifically this can involve technology such as Consul, Zookeeper and the Netflix OSS stack.</p>
<p>We’ll now check out some of the patterns made available to you by utilizing Spring Cloud, and related tooling, through the medium of terrible drawings.</p>
<h1 id="Netflix-OSS"><a href="#Netflix-OSS" class="headerlink" title="Netflix OSS"></a>Netflix OSS</h1><p>A ton of the functionality provided here is backed by the Netflix OSS stack. Service discovery, load balancing, fault tolerance and gateway routing features are all supporting by Netflix’s toolset, although the full stack does much more than this. In the picture below, I’ve marked out the specific libraries we’ll be checking out later, with a few notes as to their general purpose.</p>
<p><img src="/images/spring-microservices/netflix.png" alt=""></p>
<hr>
<h1 id="Configuration-Management-with-Spring-Cloud"><a href="#Configuration-Management-with-Spring-Cloud" class="headerlink" title="Configuration Management with Spring Cloud"></a>Configuration Management with Spring Cloud</h1><p>At the tail end of the last century, NASA sent an orbiter to Mars with the intention of surveying the red planet to understand its water history and to search for the traces of evidence to suggest that life had once existed there. The spacecraft arrived, after a grueling ten month journey, only for disaster to strike and it burn up in the Martian atmosphere after flying almost 105 miles closer to the planet’s surface then intended. The reason for this, it turned out afterwards, was due to a misunderstanding between two separate development teams as to the units of force used throughout the system. On one hand, propulsion engineers at Lockheed Martin had used their standard expression of force in pounds. However, in space engineering, the commonly used units are newtons, and NASA engineers hadn’t thought to question any mismatch when integrating components. One pound of force is around 4.45 newtons, providing enough of a difference to cause the disaster.</p>
<p>So how does this relate at all to configuration management? Well, it’s a fairly crude example of the importance of a single source of truth, and how miscommunication across components in a system can result in a catastrophic outcome. The principles at work here apply to the services within a distributed system - most specifically, in this case, related to configuration of those services, and the concept of <em>configuration drift</em>. Let’s look at a definition of this:</p>
<blockquote><p>Configuration Drift is the phenomenon where running servers in an infrastructure become more and more different as time goes on, due to manual ad-hoc changes and updates, and general entropy.</p>
<footer><strong>DZone</strong><cite><a href="https://dzone.com/articles/configuration-drift" target="_blank" rel="noopener">dzone.com/articles/configuration-drift</a></cite></footer></blockquote>
<p>Instances of microservices should be totally unremarkable, and completely replaceable. Having any chance of a unique configuration being introduced to one service over others could cause unexpected issues within a production setting - and any kind of property/configuration file tied to a single instance of a service provides that chance.</p>
<p><img src="/images/spring-microservices/kaboom.png" alt=""></p>
<p>This is where a centralized configuration strategy can help. All services point at that single source of truth, making divergence of configuration across them much less likely. As a second bonus feature the ability to change that one piece of information to affect all dependents instantly, can streamline general management of configuration within your distributed application.</p>
<p><img src="/images/spring-microservices/config.png" alt=""></p>
<h1 id="Service-Discovery-with-Ribbon-amp-Eureka"><a href="#Service-Discovery-with-Ribbon-amp-Eureka" class="headerlink" title="Service Discovery with Ribbon &amp; Eureka!"></a>Service Discovery with Ribbon &amp; Eureka!</h1><p>Another important aspect of a distributed system is how you actually connect all those moving parts together in the first place! Of course, it’s easy to statically configure a set of addresses on service boot, but what if one of those endpoints disappears or becomes unhealthy?</p>
<p>Eureka! and it’s partner, Ribbon, were designed to help solve this problem. As a service starts it registers itself with the central Eureka service. This allows any dependent service to find out who to talk to via this central point.</p>
<p>Eureka keeps tabs on a service instance by prodding it’s health-check API to ensure that it is available and happy to serve. If an instance is found to be unavailable or reporting issues, it is removed from the working list.</p>
<p>Ribbon keeps the client side of this arrangement simple. It is a request side library that keeps in touch with Eureka to keep track of those addresses that serve a certain function. It abstracts away the physical addresses for a location-transparent reference which we can use within our code to decouple our service from any of those upstream.</p>
<p><img src="/images/spring-microservices/eureka.png" alt=""></p>
<h1 id="Failing-Successfully-with-Hystrix"><a href="#Failing-Successfully-with-Hystrix" class="headerlink" title="Failing Successfully with Hystrix"></a>Failing Successfully with Hystrix</h1><p>Netflix’s Hystrix is a fault tolerance library designed to prevent cascading failures across a distributed system - a place where failure is almost certainly going to occur at some point.</p>
<p>Application architecture is generally well enough designed to cater for large-scale failure, and by this I mean situations like a full server outage. Databases are replicated so that they can lose a cluster member and still remain unhindered. API calls are often load balanced across a number of identical instances of an application to avoid any single point of failure.</p>
<p>However, smaller scale failure, or a downward spiral of QoS, are generally less well handled. Specifically aspects such as intermittent failure and ever-increasing latency of upstream responses are not well catered for and so requests eventually back up, and overwhelm the system.</p>
<h2 id="Circuit-Breakers"><a href="#Circuit-Breakers" class="headerlink" title="Circuit Breakers"></a>Circuit Breakers</h2><p>A circuit breaker functions in a manner similar to its electrical counterpart. But rather than detecting an electrical surge it tries to prevent a situation where a struggling upstream service is becoming increasingly more stressed due to an overwhelming number of requests. It does this by monitoring the lifecycle of a remote service call. If the latency begins to creep up the connection is cut protecting its dependency.</p>
<p>Once disconnected, the behaviour of the circuit breaker changes somewhat. As calls continue to enter the service to which the circuit breaker belongs, the upstream endpoint is tested until we see that good service is resumed, at which point the circuit breaker is closed again and requests are allowed to flow freely once again.</p>
<p><img src="/images/spring-microservices/circuitbreaker.png" alt=""></p>
<p>As you can imagine, if the circuit breaker is open the requests are unable to successfully complete. Although beneficial to the upstream service being protected, it’s not great for the client that made the request in the first place.</p>
<p>This is where an extension of this pattern becomes useful.</p>
<h3 id="Fallbacks"><a href="#Fallbacks" class="headerlink" title="Fallbacks"></a>Fallbacks</h3><p>Instead of just allowing the request to crash ‘n’ burn, we can fail more gracefully by providing a fallback to our incomplete API call. This can be provided by a cache, an alternative or even just plain old stubbed data. The important thing is that to an outsider it looks just like the real thing.</p>
<p>For example - let’s say you are a service providing some personalized recommendations, but the recommendation engine has been circuit broken. By providing some general pre-cached recommendations an end user wouldn’t notice the difference, unless they <em>really</em> started poking around.</p>
<h2 id="Bulkhead"><a href="#Bulkhead" class="headerlink" title="Bulkhead"></a>Bulkhead</h2><p>Have you ever experienced a performance issue where a slow running resource, be it a database or API call, has caused requests to back up and eventually consume all the threads in your app. The reason for this is that your app is acting like a big hollow rowing boat - one leak and water eventually consumes the whole thing.</p>
<p>The bulkhead pattern (in reference to a ship’s bulk heads) is a way to isolate different remote calls into their own thread pools. If one remote resource causes requests to queue up then the problem is isolated to that single resource, protecting the rest of the application to carry on as normal as possible.</p>
<p><img src="/images/spring-microservices/bulkhead.png" alt=""></p>
<h1 id="Zuul"><a href="#Zuul" class="headerlink" title="Zuul"></a>Zuul</h1><p>Zuul (as in that nightmarish dog-monster thing from Ghostbusters) acts as a gatekeeper to your full suite of microservices. This single entrypoint for all requests allows you to manage several cross-cutting concerns in one place. Aspects such as security, monitoring and logging, to name but a few.</p>
<p>Zuul can intercept a request at potentially three separate points in the lifecycle of a request, allowing you to decorate with additional functionality as appropriate.</p>
<ul>
<li><strong>pre filters</strong> add custom logic to process the request as it enters your “domain”</li>
<li><strong>post filters</strong> are the final stop as a response leaves your platform. For example, to log the completion of the request.</li>
<li><strong>route filters</strong> intercept the request before it travels upstream and gives you the chance to alter its destination. Great for managing A/B testing, and similar strategies.</li>
</ul>
<p>In addition to this Zuul integrates seamlessly with the Eureka service discovery engine, to be able to dynamically determine healthy upstream resources.</p>
<p><img src="/images/spring-microservices/zuul.png" alt=""></p>
<h1 id="Event-Based-Architecture"><a href="#Event-Based-Architecture" class="headerlink" title="Event Based Architecture"></a>Event Based Architecture</h1><p>Often microservices communicate via RESTful API calls. REST implies synchronicity because the request/response are naturally tied together and as such cause a fairly tight coupling between two services.</p>
<p>Unfortunately, this tight coupling causes some complexity in managing communication in aspects such as fault tolerance (i.e the Hystrix library we discussed earlier). Synchronous communication is also much more affected by general slowness making graceful degradation a tricky prospect.</p>
<p>By decoupling services through some kind of message bus we gain many advantages through asynchronous messaging. The ability to easily scale, to cope with outages and downtime, and to evolve your architecture to support additional consumers, are all great benefits that can make your system much more resilient and flexible.</p>
<p><img src="/images/spring-microservices/messages.png" alt=""></p>
<h1 id="Zipkin"><a href="#Zipkin" class="headerlink" title="Zipkin"></a>Zipkin</h1><p>With all of this technology chatting away in a distributed fashion it can make debugging a production issue quite a challenge, to say the least.</p>
<p>The <a href="http://opentracing.io/" target="_blank" rel="noopener">OpenTracing</a> initiative aims to alleviate this problem by providing a vendor, language and framework independent solution - of which <a href="http://zipkin.io/" target="_blank" rel="noopener">Zipkin</a> is a member.</p>
<p>A single request flow, or trace, is started at our gateway (e.g. Zuul) and propagates through the full traversal. Each trace is broken down into a number of spans which represent some service processing step such as a database call.</p>
<p>Traces are captured and logged to a central service for only a small sample of requests (by default 10%). The final outcome is a visual representation of the lifecycle of a request through your system, accompanied by some key metrics at each stage (span) allowing you to track down those sneaky areas of concern. </p>
<p><img src="/images/spring-microservices/zipkin.png" alt=""></p>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>Spring Cloud can greatly simplify the development of a suite of robust, cleanly integrated microservices. However, there is an open question as to how well this integration stretches to non-spring services - and, of course, part of the microservice mantra is to use the right tool for each job, which may lead to a more diverse technology footprint across many teams. I suppose this may be the case in which a service mesh makes most sense. But if you are starting out with a handful of Java based services, you could do much worse than adopting the Spring Cloud framework and it’s associates.</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://lucasmatt.com/2017/08/22/spring-microservices/" data-id="cjhz4jghs000og5r1vnnwc7zt" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://lucasmatt.com/2017/08/22/spring-microservices/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://lucasmatt.com/2017/08/22/spring-microservices/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-python-async" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/08/13/python-async/">Python 3 Asyncio</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2017/08/13/python-async/">
            <time datetime="2017-08-13T00:00:00.000Z" itemprop="datePublished">2017-08-13</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/Programming/">Programming</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/async/">async</a>, <a class="tag-link" href="/tags/python/">python</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/images/python-async/python.jpg" alt=""></p>
<div style="text-align: right"><sub><sup><a href="https://www.flickr.com/photos/29880452@N05/2819784303/" target="_blank" rel="noopener">“Carpet Python”</a> (<a href="https://creativecommons.org/licenses/by-nc/2.0/" target="_blank" rel="noopener">CC BY-NC 2.0</a>) by <a href="https://www.flickr.com/people/29880452@N05/" target="_blank" rel="noopener">exhibitionwhitmore</a></sup></sub></div>

<hr>
<p>Asynchronous programming has become a core practice over the last decade. <em>One thread per request</em> architectures have disappeared for the most part and have been replaced by non-blocking functionality, whether a <em>Servlet 3</em> style @Suspend, NIO actor support via <em>Akka</em> or coding at a lower level against the <em>Netty</em> framework. Of course there are many advantages to asynchronous programming, most centered around resource efficiency and avoiding CPU context switches - but that’s a topic that has already been very well covered many times over, so I’ll avoid a detour right now.</p>
<p>Python has had some great asynchronous options for a long time. <em>Gevent</em>, <em>Twisted</em> and <em>Tornado</em> have all had, and continue to have, a great community to support them. Each being a standalone library they have a certain opinionated approach that is somewhat incompatible with the others. For example, <em>Tornado</em> is specifically targeted at web application programming whereas <em>Gevent</em> and <em>Twisted</em> are more general concurrency libraries for interleaving non-blocking ‘threads’.</p>
<p>Enter <code>async</code>/<code>await</code>. Python 3 seems to finally be gaining the traction it deserves to help it overthrow the long standing Python 2 dominance. One major evolution that has been added fairly recently (late 2015) is the native asyncio library that gives us coroutine support directly within the core language.</p>
<p>Let’s spend a little time checking out examples of this exciting new feature, but first - what the heck are coroutines?</p>
<h1 id="Programming-with-Coroutines"><a href="#Programming-with-Coroutines" class="headerlink" title="Programming with Coroutines"></a>Programming with Coroutines</h1><p>So what are coroutines? They’re not something I’d ever come across in the Java world, and they take a little getting used to. Here’s the formal definition:</p>
<blockquote><p>Coroutines are computer program components that generalize subroutines for non-preemptive multitasking, by allowing multiple entry points for suspending and resuming execution at certain locations. Coroutines are well-suited for implementing more familiar program components such as cooperative tasks, exceptions, event loops, iterators, infinite lists and pipes.</p>
<footer><strong>Wikipedia</strong><cite><a href="https://en.wikipedia.org/wiki/Coroutine" target="_blank" rel="noopener">en.wikipedia.org/wiki/Coroutine</a></cite></footer></blockquote>
<p>Umm, … so … did that make sense? I gather that it’s something about pausing and resuming execution, but that’s about it.</p>
<p>Let’s try a real world analogy - picking up some dinner from your favourite takeaway.</p>
<p><img src="/images/python-async/takeaway.jpg" alt=""></p>
<div style="text-align: right"><sub><sup><a href="https://www.flickr.com/photos/126337928@N05/23964405150/" target="_blank" rel="noopener">“Takeaway”</a> (<a href="https://creativecommons.org/licenses/by/2.0/" target="_blank" rel="noopener">CC BY 2.0</a>) by <a href="https://www.flickr.com/people/126337928@N05/" target="_blank" rel="noopener">Dai Lygad</a></sup></sub></div>

<p>Arriving at the takeaway you politely join the queue of customers (the coroutines) waiting in line to get served by the cashier. For simplicity’s sake, let’s assume there is only one cashier able to serve you. This person represents the main process, or event loop.</p>
<p>Each customer is served by the cashier one at a time. He/she takes your order, money, and gives you a little ticket representing the meal being prepared behind the scenes. The process of cooking your food represents external I/O, such as a network call or filesystem access.</p>
<p>Now, in a blocking I/O world, you and the cashier would awkwardly eyeball each other for the full length of time it took to cook your food - the other customers looking on in frustration. By using coroutines, rather than keeping the poor cashier occupied, you put your interaction on hold and go wait quietly in the corner so that another customer can be served in the meantime. When your food is ready to go the cashier is notified by the kitchen and resumes your interaction to complete the process.</p>
<p>In a similar way coroutines yield their control of the main thread when they encounter a blocking operation and then resume execution once that operation completes. This allows for the core process to remain active as long as there is valuable work to be done, rather than blocking important tasks whilst waiting on external factors.</p>
<p>Now for some specific examples.</p>
<h1 id="Hello-World-of-Asyncio"><a href="#Hello-World-of-Asyncio" class="headerlink" title="Hello World of Asyncio"></a>Hello World of Asyncio</h1><p>Let’s start off with the obligatory ‘hello world’.</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line">async def hey():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Hello World!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">loop</span> = asyncio.get_event_loop()</span><br><span class="line"><span class="built_in">loop</span>.run_until_complete(hey())</span><br><span class="line"><span class="built_in">loop</span>.<span class="built_in">close</span>()</span><br></pre></td></tr></table></figure>
<p>The function itself is pretty mundane although it is marked with the <code>async</code> keyword to denote its nature. To get access to the event loop to execute this special type of routine, we grab it from asyncio and ask it to run our coroutine to completion.</p>
<p>The example below is slightly more interesting, showing how coroutines can interact with and utilize one another. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">excl</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"!"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">world</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"World"</span> + <span class="keyword">await</span> excl()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"Hello "</span> + <span class="keyword">await</span> world())</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(hello())</span><br><span class="line">loop.close()</span><br></pre></td></tr></table></figure>
<p>Here we are introduced to the <code>await</code> keyword. This allows one coroutine to yield its program flow until we get the result from another asynchronous operation, at which point we can resume operation. Rather simply, here we are just chaining the invocation and resolution of a series of coroutines.</p>
<h1 id="Fibonacci-Time-and-Async-Decorators"><a href="#Fibonacci-Time-and-Async-Decorators" class="headerlink" title="Fibonacci Time and Async Decorators"></a>Fibonacci Time and Async Decorators</h1><p>Now for something a bit meatier - recursion and decoration!</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">memo</span><span class="params">(fn)</span>:</span></span><br><span class="line">    cache = &#123;&#125;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">wrap</span><span class="params">(n)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> n <span class="keyword">in</span> cache:</span><br><span class="line">            print(<span class="string">"found %s in cache"</span> % (n))</span><br><span class="line">            <span class="keyword">return</span> cache[n]</span><br><span class="line">        res = <span class="keyword">await</span> fn(n)</span><br><span class="line">        print(<span class="string">"calculated %s"</span> % (n))</span><br><span class="line">        cache[n]= res</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">return</span> wrap</span><br><span class="line"></span><br><span class="line"><span class="meta">@memo</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">fibn</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> fibn(n<span class="number">-2</span>) + <span class="keyword">await</span> fibn(n<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">c = loop.run_until_complete(asyncio.gather(fibn(<span class="number">4</span>), fibn(<span class="number">4</span>), fibn(<span class="number">4</span>)))</span><br><span class="line">print(c)</span><br><span class="line">loop.close()</span><br></pre></td></tr></table></figure>
<p>First, take a look at the <code>fibn</code> function. This is a good old recursive fibonacci, however the delegate calls are made asynchronously. Of course, this gives no real benefit, but does prove we can invoke coroutines in a recursive fashion. </p>
<p>More interestingly we have implemented a memoizing decorator that will cache the result of an asynchronous call. We have to be careful to declare the wrapper function (as created within the decorator) as <code>async</code> so that we can <code>await</code> completion of the decorated function. </p>
<h1 id="But-Who-Cares-About-Async-Fibonacci"><a href="#But-Who-Cares-About-Async-Fibonacci" class="headerlink" title="But Who Cares About Async Fibonacci!?"></a>But Who Cares About Async Fibonacci!?</h1><p>Playing with these toy functions is all very well, but what bearing does this have on helping us solve real world problems?</p>
<p>TBH, the list of libraries supporting <code>async</code>/<code>await</code> functionality right now (at least at the time of writing) seems to be fairly limited. Obviously the intention is that over time this will become a much more richly supported and standardized way of writing asynchronous code with the core python language. Although, having said that, as long as you’re using fairly common technology you’ll likely find at least one driver that supports this approach.</p>
<p>In this final example we can see how easy it is to wire up an asynchronous application end-to-end - a REST service that reads and writes asynchronously to mongodb.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> aiohttp <span class="keyword">import</span> web</span><br><span class="line"><span class="keyword">from</span> motor.motor_asyncio <span class="keyword">import</span> AsyncIOMotorClient</span><br><span class="line"></span><br><span class="line">client = AsyncIOMotorClient(<span class="string">'mongodb://mongodb:27017'</span>)</span><br><span class="line">db = client.demo</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">retrieve</span><span class="params">(req)</span>:</span></span><br><span class="line">    id = req.match_info.get(<span class="string">'id'</span>)</span><br><span class="line">    result = <span class="keyword">await</span> db.stuff.find_one(&#123;<span class="string">'_id'</span>: id&#125;)</span><br><span class="line">    <span class="keyword">if</span> result:</span><br><span class="line">        <span class="keyword">return</span> web.Response(body=json.dumps(result))</span><br><span class="line">    <span class="keyword">return</span> web.Response(status=<span class="number">404</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">(req)</span>:</span></span><br><span class="line">    id = req.match_info.get(<span class="string">'id'</span>)</span><br><span class="line">    json = <span class="keyword">await</span> req.json()</span><br><span class="line">    json[<span class="string">'_id'</span>] = id</span><br><span class="line">    result = <span class="keyword">await</span> db.stuff.replace_one(&#123;<span class="string">'_id'</span>: id&#125;, json, upsert=<span class="keyword">True</span>)</span><br><span class="line">    status = <span class="number">200</span> <span class="keyword">if</span> result.matched_count &gt;= <span class="number">1</span> <span class="keyword">else</span> <span class="number">201</span></span><br><span class="line">    <span class="keyword">return</span> web.Response(status=status)</span><br><span class="line"></span><br><span class="line">app = web.Application()</span><br><span class="line">app.router.add_get(<span class="string">'/stuff/&#123;id&#125;'</span>, retrieve)</span><br><span class="line">app.router.add_put(<span class="string">'/stuff/&#123;id&#125;'</span>, save)</span><br><span class="line">web.run_app(app)</span><br></pre></td></tr></table></figure>
<p>There are a few notable points in this small application.</p>
<ul>
<li><code>[line 8, 15]</code> First we have the handling of requests themselves. Our handlers are specified as coroutines so that the HTTP server doesn’t have to block a thread whilst waiting for the end-to-end response to complete.</li>
<li><code>[line 17]</code> Even trivial I/O, such as reading the request payload from the socket, is handled in an efficient way.</li>
<li><code>[line 10, 19]</code> As expected, any database access is handled in a non-blocking fashion.</li>
</ul>
<p>So pretty simple stuff, but it all seems to fit together in a sensible and consistent manner. It’ll be interesting to see how this feature of python evolves both within the language and across the ecosystem over the next few years.</p>
<p>Happy non-blocking!</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://lucasmatt.com/2017/08/13/python-async/" data-id="cjhz4jgho000jg5r1io400vui" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://lucasmatt.com/2017/08/13/python-async/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://lucasmatt.com/2017/08/13/python-async/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-microservice-mtg-2" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/31/microservice-mtg-2/">Microservices Part 2: Breaking Up That Monolith</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2017/07/31/microservice-mtg-2/">
            <time datetime="2017-07-31T00:00:00.000Z" itemprop="datePublished">2017-07-31</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/Architecture/">Architecture</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/microservices/">microservices</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/images/microservice-mtg-2/chop.jpg" alt=""></p>
<div style="text-align: right"><sub><sup><a href="https://www.flickr.com/photos/nothing/5150721/" target="_blank" rel="noopener">“axe”</a> (<a href="https://creativecommons.org/licenses/by-nc/2.0/" target="_blank" rel="noopener">CC BY-NC 2.0</a>) by <a href="https://www.flickr.com/people/nothing/" target="_blank" rel="noopener">nothing</a></sup></sub></div>

<hr>
<p><em>This post is part of a larger series on the challenges commonly encountered whilst adapting and running a microservice style architecture. For further entries in this series please check out the following links</em>:</p>
<ul>
<li><em><a href="/2017/07/17/microservice-mtg-1/" title="Part 1: Introduction">Part 1: Introduction</a></em></li>
<li><em><a href="/2017/07/31/microservice-mtg-2/" title="Part 2: Breaking Up That Monolith">Part 2: Breaking Up That Monolith</a></em></li>
<li>Part 3: Communication &amp; Evolution</li>
<li>Part 4: Organization &amp; Standardization</li>
<li>Part 5: Preparing to Fail</li>
</ul>
<hr>
<p>One of the most important problems you’ll encounter whilst developing and evolving a microservice architecture is that of dividing up an existing monolith or domain into a number of well defined and decoupled entities.</p>
<p>So how can we divide and conquer in a sensible manner? First let’s look at one of the approaches taken by Domain Driven Design - specifically that of <em>Bounded Contexts</em>.</p>
<h1 id="Bounded-Context"><a href="#Bounded-Context" class="headerlink" title="Bounded Context"></a>Bounded Context</h1><p>When developing any application you spend much of your time modeling the real world that it is designed to serve. The terminology that emerges out of this process generally becomes accepted across the development team as a whole, forming the unified domain model for your business. These same concepts get encoded as objects with various states and behaviors inside your application.</p>
<p>However, once the application reaches a certain size it becomes increasingly difficult to stretch these models to cover all aspects of the business domain. For example, an ‘account’ will likely mean something very different to the billing department than one geared towards managing security. This can lead to a confusion of responsibilities within the model, and whilst teams will generally develop using the same terminology in reality they actually mean very different things.</p>
<p>A solution proposed by the <a href="https://www.amazon.co.uk/Domain-driven-Design-Tackling-Complexity-Software/dp/0321125215" target="_blank" rel="noopener">Domain Driven Design</a> methodology is to divide up our unified model. This approach improves upon the above by chopping these conflicting concerns into a number of separate areas - each a bounded context. This allows for coherent discussion and clear modeling to take place within the bounds of a context, adhering more closely to the single responsibility principle. It also allows us to map out the relationships between each bounded context so that the interactions between them are more clearly defined.</p>
<p>To continue our ‘account’ example, we would split both ‘billing’ and ‘security’ into different bounded contexts. We are then able to reason about the concerns of the model separately - the billing team concerning themselves more with payments, whilst security with any rights or permissions given to an account.</p>
<p><img src="/images/microservice-mtg-2/bounded-context.png" alt="Bounded Context Example"></p>
<p>It follows from this, that the way we breakup our application into services corresponds very naturally to the bounded contexts we define. Taking this approach allows us to reduce the amount of knowledge that any one team has to keep in mind, as the focus only has to be within a specific context. This also leads to more cleanly separated entities, which should reduce external dependencies and simplify over-complicated chatter.</p>
<p>In short, a service should correspond to a single business domain, and not cross boundaries.</p>
<h1 id="Things-that-Change-Together-Stay-Together"><a href="#Things-that-Change-Together-Stay-Together" class="headerlink" title="Things that Change Together Stay Together"></a>Things that Change Together Stay Together</h1><p>The ability to separate business concerns into neat little packages that can be managed and worked on separately is what enables all that <em>dividing</em> to actually <em>conquer</em> your monster scalability problem. Let’s quickly review two fairly simple but fundamental concepts of good software design:</p>
<blockquote><p><strong>Cohesion</strong> refers to the degree to which the elements inside a module belong together. Thus, cohesion measures the strength of relationship between pieces of functionality within a given module. For example, in highly cohesive systems functionality is strongly related.</p>
<footer><strong>Wikipedia</strong><cite><a href="https://en.wikipedia.org/wiki/Cohesion_(computer_science)" target="_blank" rel="noopener">en.wikipedia.org/wiki/Cohesion_(computer_science)</a></cite></footer></blockquote>
<blockquote><p><strong>Coupling</strong> is the degree of interdependence between software modules; a measure of how closely connected two routines or modules are; the strength of the relationships between modules.</p>
<footer><strong>Wikipedia</strong><cite><a href="https://en.wikipedia.org/wiki/Coupling_(computer_programming)" target="_blank" rel="noopener">en.wikipedia.org/wiki/Coupling_(computer_programming)</a></cite></footer></blockquote>
<p>After revisiting these concepts it becomes clearer that microservices should be highly cohesive but loosely coupled. Concepts and functionality that are strongly related need to be kept within the bounds of the same service. Conversely, more weakly related concepts should tend to exist within separate modules.</p>
<p>An architecture that keeps correlated concerns together and pushes unrelated concepts apart allows for more robust development and deployment strategies. Due to this loose coupling of components, the impacts of one service on another should be simplified to allow for both parallel development (with fewer blocking elements between teams) and an independent deployment lifecycle - i.e. avoiding the need to orchestrate delivery between whole suites of services.</p>
<p>If you find that the addition of a feature to your application requires a tough co-ordination effort, then you should consider whether your microservices really are cohesive and loosely coupled, or if abstractions and business logic are crossing several boundaries. If several services are always changing in step with one another then the question really is whether they’re partitioned well-enough? If the answer seems to be no, then it’s time to start merging and refactoring those components to achieve a smarter separation.</p>
<h1 id="Strangler-Pattern"><a href="#Strangler-Pattern" class="headerlink" title="Strangler Pattern"></a>Strangler Pattern</h1><p><img src="/images/microservice-mtg-2/strangler-real.jpg" alt=""></p>
<div style="text-align: right"><sub><sup><a href="https://www.flickr.com/photos/dany13/30109648515/" target="_blank" rel="noopener">“IMG_9322/Ile Maurice/Trou Aux Biches/Big”</a> (<a href="https://creativecommons.org/licenses/by/2.0/" target="_blank" rel="noopener">CC BY 2.0</a>) by <a href="https://www.flickr.com/people/dany13/" target="_blank" rel="noopener">dany13</a></sup></sub></div>

<p>It’s very rare that a greenfield project lands in your lap. Unfortunately for us developers most of our days are spent maintaining and evolving existing systems. This is definitely something that microservices (done well) can help you tackle more easily in future, but let’s come back to today’s reality. How we can sensibly refactor an existing ball-of-mud application into a more managable architecture?</p>
<h2 id="Beware-the-Big-Rewrite"><a href="#Beware-the-Big-Rewrite" class="headerlink" title="Beware the Big Rewrite"></a>Beware the Big Rewrite</h2><p>After decades of high profile failures it has generally become a natural intuition of software professionals to avoid “The Big Rewrite”, but it’s worth a cautionary mention anyhow. </p>
<p><em>Second System Syndrome</em> refers to the common outcome of replacing a profitable, but flawed, system with a complete rewrite that generally misses much of the point of what made the original system successful in the first place.</p>
<blockquote><p>When it seems to be working well, designers turn their attention to a more elaborate second system, which is often bloated and grandiose and fails due to its over-ambitious design. In the meantime, the first system may also fail because it was abandoned and not continually refined.</p>
<footer><strong>Mythical Man Month</strong><cite><a href="https://www.goodreads.com/book/show/13629.The_Mythical_Man_Month" target="_blank" rel="noopener">www.goodreads.com/book/show/13629.The_Mythical_Man_Month</a></cite></footer></blockquote>
<h2 id="What-is-the-‘Strangler-Pattern’"><a href="#What-is-the-‘Strangler-Pattern’" class="headerlink" title="What is the ‘Strangler Pattern’?"></a>What is the ‘Strangler Pattern’?</h2><p>The Strangler Pattern is a method of slowly wrapping and replacing an existing system, usually a monolith, in a slow and methodical fashion. It is named after the strangler fig vines found in tropical climates. These vines slowly grow upon an existing tree, eventually covering (and effectively replacing) the host.</p>
<p>This same pattern can be applied in evolving a piece of software. One by one, each part of the application (potentially identified by a bounded context) is refactored into a new service and spun out on its own. A façade provides the single entry point to your API disguising those parts of the app that have been migrated vs those which are still waiting in line for attention. </p>
<img src="/images/microservice-mtg-2/strangler.jpg" width="400" title="Stranger Pattern">
<p>This iterative process gives us many benefits, including:</p>
<ul>
<li>Keeping each refactoring managable due to its small, well defined, context</li>
<li>Constant validation of the new functionality vs the old in a real-world, production, scenario</li>
<li>Ability to handle failure more gracefully due to a rollback being as simple as redirecting the façade’s requests</li>
</ul>
<h1 id="Next-Time"><a href="#Next-Time" class="headerlink" title="Next Time"></a>Next Time</h1><p>Next time, we’ll look into the communication patterns available to connect your microservices together in a maintainable and robust way. </p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a href="http://blog.xebia.com/microservices-architecture-principle-3-small-bounded-contexts-over-one-comprehensive-model/" target="_blank" rel="noopener">Microservices Architecture Principle #3: small bounded contexts over one comprehensive model</a></li>
<li><a href="https://martinfowler.com/bliki/BoundedContext.html" target="_blank" rel="noopener">Bounded Context</a></li>
<li><a href="http://blog.sapiensworks.com/post/2012/04/17/DDD-The-Bounded-Context-Explained.aspx" target="_blank" rel="noopener">DDD - The Bounded Context Explained</a></li>
<li><a href="https://www.amazon.co.uk/Domain-driven-Design-Tackling-Complexity-Software/dp/0321125215" target="_blank" rel="noopener">Domain Driven Design</a></li>
<li><a href="https://www.martinfowler.com/bliki/StranglerApplication.html" target="_blank" rel="noopener">Martin Fowler - Strangler Application</a></li>
<li><a href="https://www.ibm.com/developerworks/cloud/library/cl-strangler-application-pattern-microservices-apps-trs/index.html" target="_blank" rel="noopener">Apply the Strangler Application pattern to microservices applications</a></li>
<li><a href="https://www.amazon.co.uk/Mythical-Man-month-Essays-Software-Engineering/dp/0201835959/ref=sr_1_3?s=books&amp;ie=UTF8&amp;qid=1501257288&amp;sr=1-3&amp;keywords=mythical+man+month" target="_blank" rel="noopener">Mythical Man Month</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/strangler" target="_blank" rel="noopener">Strangler Pattern</a></li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://lucasmatt.com/2017/07/31/microservice-mtg-2/" data-id="cjhz4jghn000ig5r178vw6w6o" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://lucasmatt.com/2017/07/31/microservice-mtg-2/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://lucasmatt.com/2017/07/31/microservice-mtg-2/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-microservice-mtg-1" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/17/microservice-mtg-1/">Microservices (Mind the Gap) Part 1: An Introduction</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2017/07/17/microservice-mtg-1/">
            <time datetime="2017-07-17T00:00:00.000Z" itemprop="datePublished">2017-07-17</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/Architecture/">Architecture</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/microservices/">microservices</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/images/microservice-mtg-1/mindthegap.jpg" alt=""></p>
<div style="text-align: right"><sub><sup><a href="https://www.flickr.com/photos/rk_photos/4914255517/" target="_blank" rel="noopener">“Mind the gap”</a> (<a href="https://creativecommons.org/licenses/by-nc-nd/2.0/" target="_blank" rel="noopener">CC BY-NC-ND 2.0</a>) by <a href="https://www.flickr.com/people/rk_photos/" target="_blank" rel="noopener">raghavvidya</a></sup></sub></div>

<hr>
<p><em>This post is part of a larger series on the challenges commonly encountered whilst adapting and running a microservice style architecture. For further entries in this series please check out the following links</em>:</p>
<ul>
<li><em><a href="/2017/07/17/microservice-mtg-1/" title="Part 1: Introduction">Part 1: Introduction</a></em></li>
<li><em><a href="/2017/07/31/microservice-mtg-2/" title="Part 2: Breaking Up That Monolith">Part 2: Breaking Up That Monolith</a></em></li>
<li>Part 3: Communication &amp; Evolution</li>
<li>Part 4: Organization &amp; Standardization</li>
<li>Part 5: Preparing to Fail</li>
</ul>
<hr>
<h1 id="Introduction-aka-‘The-Positive-Bit’"><a href="#Introduction-aka-‘The-Positive-Bit’" class="headerlink" title="Introduction (aka ‘The Positive Bit’)"></a>Introduction (aka ‘The Positive Bit’)</h1><p>The microservice architectural style seems to be continuing with its ever-rising popularity, and with good reason. There is a lot to be gained from adopting this model to ensure that your large application can be developed at a fast pace, scaled appropriately, and delivered to production with higher frequency and less overall risk.</p>
<p>Let’s discuss some of the key benefits of a microservice architecture.</p>
<h3 id="Scaling-Your-Development-Team"><a href="#Scaling-Your-Development-Team" class="headerlink" title="Scaling Your Development Team"></a>Scaling Your Development Team</h3><p>Monolithic applications aren’t actually a bad thing (despite the constant bad press), but once your product reaches a certain size you will likely hit several scalability challenges. The first of these will likely come as an organizational challenge rather than anything grounded in technology.</p>
<p>Many of us have worked on one of those humongous Java applications containing hundreds of thousands of lines of code, get deployed into an enterprise application server (such as JBoss or WebSphere) and are supported by some large RDBMS. To keep up with the competition teams will need to develop features on this monolith in parallel, and here’s where the problems creep in. Merge car crashes, leaky modules and an unwieldy test framework soon make the application a nightmare platform on which to develop.</p>
<p>Microservices to the rescue! When we no longer have one gigantic project, but instead many small cleanly partitioned pieces, then work on various features is also partitioned. This gives us cleaner development in an isolated and much more mangeable development environment.</p>
<p>A common, but excellent way, to picture this difference is to imagine a number of workers chipping away at a large boulder. In the monolithic case they struggle to gather around the surface well enough to get their work done without bashing away at the hands of the person next to them. When broken down into smaller pieces the surface area is greatly increased, and the workers can happily chip away in much greater comfort without bloodied hands and broken thumbs.</p>
<p><img src="/images/microservice-mtg-1/rocks.png" alt=""></p>
<h3 id="Scaling-Your-Application"><a href="#Scaling-Your-Application" class="headerlink" title="Scaling Your Application"></a>Scaling Your Application</h3><p>When your killer app does eventually go viral and needs to be scaled horizontally with a monolith you have no option but to ramp up ‘everything and the kitchen sink’ regardless of whether it’s a bottleneck or not. This can clearly result in a great deal of wasted resource to support the redundant parts of the deployment that have hitched along for the ride.</p>
<p>In the case of microservices, because they’re already nicely chopped up into sensible parts, then we can scale out only the bits that we need, allowing us to much more finely tune our platform to the traffic hitting it.</p>
<h3 id="Reducing-Deployment-Risk"><a href="#Reducing-Deployment-Risk" class="headerlink" title="Reducing Deployment Risk"></a>Reducing Deployment Risk</h3><p>In a similar vein to the above, the divide and conquer approach of microservices can also, <em>if done correctly</em>, make your deployment simpler and more stable.</p>
<p>In the case of a monolith any upgrade will, by it’s nature, include all changes made to the monolith since the last release. If something were to go wrong during the upgrade then the cause could come from any number of new features, not to mention the sheer complexity you hit in just getting a large application up and running in the first place.</p>
<p>By splitting out the moving parts we can also separate out their deployment. Smaller, more controlled, deployments result in less surprise, less uncertainty and makes quickly reverting back to a known state a more welcoming prospect than rolling back a huge upgrade.</p>
<h3 id="Upcoming-The-Spooky-Part"><a href="#Upcoming-The-Spooky-Part" class="headerlink" title="Upcoming: The Spooky Part"></a>Upcoming: The Spooky Part</h3><p><img src="/images/microservice-mtg-1/ghost.jpg" alt=""></p>
<div style="text-align: right"><sub><sup><a href="https://www.flickr.com/photos/halloweenstock/8117718787/" target="_blank" rel="noopener">“green sheet spook”</a> (<a href="https://creativecommons.org/licenses/by/2.0/" target="_blank" rel="noopener">CC BY 2.0</a>) by <a href="https://www.flickr.com/people/halloweenstock/" target="_blank" rel="noopener">creepyhalloweenimages</a></sup></sub></div>

<p>But I’m not here to blindly praise the wonders of a microservice architecture - and admittedly there are many potential benefits available to you - but rather I’m here to start the discussion around the scary bits, the parts that can keep you up at night in a cold sweat and make your work-day feel like herding wildcats around a data centre.</p>
<p>A microservice system is a distributed system, and distributed systems are <strong>hard</strong>! Over the next few posts in this series we’ll consider a number of different areas in which you must become proficient to avoid falling into one of the myrid traps surrounding a microservice architecture. More helpfully, we’ll also consider a number of common strategies to help you traverse this landscape safely. Specifically these topics will include subjects such as: strategies for breaking up your services, evolving them independently, and handling failure elegantly.</p>
<h1 id="Next-Time"><a href="#Next-Time" class="headerlink" title="Next Time"></a>Next Time</h1><p>We’ll look at arguably the most important step in a microservice architecture - strategies to effectively break up your application into a number of well designed microservices, whether decomposing that monolith or starting over with a clean slate.</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a href="http://shop.oreilly.com/product/0636920053675.do" target="_blank" rel="noopener">Production Ready Microservices</a></li>
<li><a href="https://martinfowler.com/articles/microservices.html" target="_blank" rel="noopener">Martin Fowler: Microservices</a></li>
<li><a href="https://www.infoq.com/podcasts/daniel-bryant" target="_blank" rel="noopener">Daniel Bryant on Microservices and Domain Driven Design</a></li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://lucasmatt.com/2017/07/17/microservice-mtg-1/" data-id="cjhz4jghk000eg5r1wja27imm" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://lucasmatt.com/2017/07/17/microservice-mtg-1/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://lucasmatt.com/2017/07/17/microservice-mtg-1/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-2016-08-24-pyintellij" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/08/24/2016-08-24-pyintellij/">Python Development with Vagrant &amp; IntelliJ</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2016/08/24/2016-08-24-pyintellij/">
            <time datetime="2016-08-24T00:00:00.000Z" itemprop="datePublished">2016-08-24</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/Development/">Development</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/intellij/">intellij</a>, <a class="tag-link" href="/tags/python/">python</a>, <a class="tag-link" href="/tags/vagrant/">vagrant</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/images/pyintellij/header.jpg" alt=""></p>
<p>I’m mostly a JVM language developer who loves the toolset that comes from the JVM world, especially that of a good IDE. Don’t get me wrong I’m partial to a bit of emacs, but I spend most of my time, these days, staring into the awesome Darcula black of IntelliJ.</p>
<p>So when it comes to developing a bit of Python I want to try to keep my foundations as comfortable as possible without compromising the new environment. More specifically this comes from developing a Linux-based Python app whilst on a Windows machine. With the power of Python stemming from its C-based libraries you lose some of that platform independence that you otherwise come to take for granted.</p>
<p>Enter Vagrant (let’s ignore Otto for now). Vagrant enables users to create and configure lightweight, reproducible, and portable development environments. This is great for development targeted at one platform whilst coding on another - a flexible sandbox that you can build up and and tear apart with the execution of a single command.</p>
<p>Also, helpfully, IntelliJ has some great bindings to allow us to develop with ease on a Vagrant environment. This is what we will quickly explore.</p>
<h2 id="vagrant-up"><a href="#vagrant-up" class="headerlink" title="vagrant up"></a>vagrant up</h2><p>To get started with Vagrant you just need to have it and VirtualBox (or similar) installed. Then a simple configuration Vagrantfile is the only hard work we need to put in. Here’s one I made earlier:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Vagrant.configure(2) do |config|</span><br><span class="line"></span><br><span class="line">  config.vm.box = &quot;bento/centos-6.7&quot;</span><br><span class="line"></span><br><span class="line">  config.vm.network &quot;forwarded_port&quot;, guest: 8080, host: 8080</span><br><span class="line"></span><br><span class="line">  config.vm.provider &quot;virtualbox&quot; do |vb|</span><br><span class="line">    vb.gui = false</span><br><span class="line">    vb.name = &quot;Intellij Vagrant Test&quot;</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  config.vm.provision &quot;shell&quot;, path: &quot;setup.sh&quot;</span><br><span class="line"></span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>Nothing much to it: just pick an image, forward some ports, change a little VM config and run the setup script once the environment has booted.</p>
<p>All that is in the setup.sh script is a little work to smooth out Python development a little.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rpm -iUvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</span><br><span class="line">yum -y install python python-pip gcc python-devel git</span><br><span class="line">pip install --upgrade setuptools</span><br><span class="line">pip install gevent</span><br></pre></td></tr></table></figure>
<p>Now just we run vagrant up, make some tea, and we’re in!</p>
<p><img src="/images/pyintellij/vagrant_up.png" width="500"></p>
<h2 id="Hooking-in-IntelliJ"><a href="#Hooking-in-IntelliJ" class="headerlink" title="Hooking in IntelliJ"></a>Hooking in IntelliJ</h2><p>Connecting up IntelliJ is actually pretty simple too. Just create a new project as usual and when the time comes create a new “Remote Interpreter”.</p>
<p><img src="/images/pyintellij/remote_interpreter.png" width="500"></p>
<p>Choose the project base (the folder containing Vagrantfile) as your Vagrant Host URL and the rest should be done automatically.</p>
<p>Once hooked in we can see details about our guest environment, such as the libraries that we have installed. To do this specifically navigate to Tools -&gt; Manage Python Packages</p>
<p><img src="/images/pyintellij/manage_packages.png" width="600"></p>
<h2 id="Throwing-Together-a-Quick-App"><a href="#Throwing-Together-a-Quick-App" class="headerlink" title="Throwing Together a Quick App"></a>Throwing Together a Quick App</h2><p>Now let’s build a very small gevent wsgi app to demonstrate how the environment works - we’ll just create a very lightweight “hello world” service.</p>
<p>First thing, setting up the tests. As we haven’t used this environment before, some of the supporting tools, mocking frameworks, etc, will be missing from the environment. That’s ok, IntelliJ makes it easy to just highlight the red parts of your code and automatically install those libraries. Check it out below with the mock framework.</p>
<p><img src="/images/pyintellij/install_mock.png" width="400"></p>
<p>Now for some example test code:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">import</span> mock</span><br><span class="line"><span class="keyword">import</span> hello.server</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestServer</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_default_response</span><span class="params">(self)</span>:</span></span><br><span class="line">        response = hello.server.hello_world(&#123;&#125;, mock.MagicMock())</span><br><span class="line">        output = next(response)</span><br><span class="line">        self.assertEqual(<span class="string">"&lt;h1&gt;Hello World!&lt;/h1&gt;"</span>, output)</span><br></pre></td></tr></table></figure>
<p>To run the test is no different than usual. Just kick off as a unit test and the remote interpreter we configured earlier will take care of the details of running the code “remotely”.</p>
<p>Of course, our test fails, as it should, at this point</p>
<p><img src="/images/pyintellij/failing_test.png" width="600"></p>
<p>Once we’ve developed our wsgi handler the test then passes.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> pywsgi</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">(environ, start_response)</span>:</span></span><br><span class="line">    start_response(<span class="string">'200 OK'</span>, [(<span class="string">'Content-Type'</span>, <span class="string">'text-html'</span>)])</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">"&lt;h1&gt;Hello World!&lt;/h1&gt;"</span></span><br><span class="line"></span><br><span class="line">server = pywsgi.WSGIServer(</span><br><span class="line">    (<span class="string">''</span>, <span class="number">8080</span>), hello_world</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    server.serve_forever()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Finally, what about running the application and debugging it? - again, IntelliJ does a great job of hiding all those abstractions.</p>
<p>Just run/debug a program as you usually would, and thanks to our port mapping we can play around with the app as if it was running natively on the host rather than in a Linux VM.</p>
<p><img src="/images/pyintellij/final_result.png" width="600"></p>
<h2 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h2><ul>
<li><a href="https://www.jetbrains.com/help/idea/2016.2/vagrant-2.html" target="_blank" rel="noopener">IntelliJ Vagrant</a></li>
<li><a href="https://www.jetbrains.com/help/pycharm/2016.1/configuring-remote-python-interpreters.html" target="_blank" rel="noopener">Configuring Remote Python Interpreters</a></li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://lucasmatt.com/2016/08/24/2016-08-24-pyintellij/" data-id="cjhz4jgha0008g5r19u51pzow" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://lucasmatt.com/2016/08/24/2016-08-24-pyintellij/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://lucasmatt.com/2016/08/24/2016-08-24-pyintellij/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-2016-08-13-7favegames" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/08/13/2016-08-13-7favegames/">#7FaveGames - Creating a Word Cloud from 346,859 Tweets</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2016/08/13/2016-08-13-7favegames/">
            <time datetime="2016-08-13T00:00:00.000Z" itemprop="datePublished">2016-08-13</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/Data-Science/">Data Science</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/data-science/">data science</a>, <a class="tag-link" href="/tags/statistics/">statistics</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/images/7favegames.png" alt=""></p>
<p>Over the last few days the hashtag <strong>#7FaveGames</strong> has been trending on<br>twitter. As you can probably guess you’re supposed to list your top seven games of<br>all time and put them out to the world to be judged!</p>
<p>Of course, I jumped straight into this trend and submitted my own faves - if<br>you’re interested, my choices are in the banner of this post.</p>
<p>Whilst trawling my own gaming history, I started to<br>wonder about the most popular games overall. A great excuse to<br>pull out the R analytics toolkit and do some amateur data science.</p>
<h2 id="Gathering-all-those-Tweets"><a href="#Gathering-all-those-Tweets" class="headerlink" title="Gathering all those Tweets"></a>Gathering all those Tweets</h2><p>The first step was to gather as many <strong>#7FaveGames</strong> tweets as<br>possible without crossing the boundaries set by the twitter API (180<br>requests per 15 minutes).</p>
<p>I decided to store all tweets with their metadata in a CSV file. This<br>makes the data much easier to explore and reload - specifically for<br>the numerous cases where I accidently trashed my in-memory copy.</p>
<h3 id="Initialize-CSV-Store"><a href="#Initialize-CSV-Store" class="headerlink" title="Initialize CSV Store"></a>Initialize CSV Store</h3><p>Initially we want to set some parameters and pull the first<br>batch. This initial chunk is used to create the CSV file to which we<br>will append during the rest of the process.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># define batch size</span></span><br><span class="line">batch &lt;- <span class="number">500</span></span><br><span class="line">sleepPeriod &lt;- <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pull first batch and initialize output file</span></span><br><span class="line">tweets &lt;- searchTwitter(<span class="string">"#7FaveGames"</span>, n=batch, retryOnRateLimit=batch)</span><br><span class="line">parsed &lt;- do.call(<span class="string">"rbind.fill"</span>, lapply(tweets, as.data.frame))</span><br><span class="line">write.table(parsed, file=<span class="string">"7favegames.csv"</span>, sep=<span class="string">","</span>, append=<span class="literal">TRUE</span>, col.names=<span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Grab-the-Rest-of-the-Data"><a href="#Grab-the-Rest-of-the-Data" class="headerlink" title="Grab the Rest of the Data"></a>Grab the Rest of the Data</h3><p>Next we just paginate, in descending chronological order, through<br>the rest of the data using the <strong>maxID</strong> key to shift the query<br>window. The last id in the current batch is used as the maxID in the<br>next to ensure a contiguous set of tweets.</p>
<p>We just keep looping through until we hit a batch smaller than<br>expected, or a NA id.</p>
<p>Admittedly it’s a pretty basic approach, but it does the job <em>… in a<br>few short hours …</em></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># while we still have tweets to read, pull batches</span></span><br><span class="line"><span class="comment"># (with respect to twitter so I don't get kicked)</span></span><br><span class="line">pull &lt;- <span class="literal">TRUE</span></span><br><span class="line"><span class="keyword">while</span> (pull) &#123;</span><br><span class="line">  <span class="comment"># grab the last id of the previous batch</span></span><br><span class="line">  id &lt;- parsed$id[batch]</span><br><span class="line">  print(c(<span class="string">"Getting batch with id "</span>, id))</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># perform a paginated search on twitter</span></span><br><span class="line">  tweets &lt;- searchTwitter(<span class="string">"#7FaveGames"</span>, n=batch+<span class="number">1</span>, retryOnRateLimit=batch, maxID=id)</span><br><span class="line">  parsed &lt;- do.call(<span class="string">"rbind.fill"</span>, lapply(tweets, as.data.frame))</span><br><span class="line"></span><br><span class="line">  <span class="comment"># strip the first record to avoid duplicates, as it was the last in the previous batch</span></span><br><span class="line">  parsed &lt;- parsed[-(<span class="number">1</span>:<span class="number">1</span>),]</span><br><span class="line">  write.table(parsed, file=<span class="string">"7favegames.csv"</span>, sep=<span class="string">","</span>, append=<span class="literal">TRUE</span>, col.names=<span class="literal">FALSE</span>)</span><br><span class="line">  pull &lt;- (nrow(parsed) &gt; <span class="number">1</span>) || (!is.na(id))</span><br><span class="line"></span><br><span class="line">  <span class="comment"># just pause for a moment to avoid hammering the twitter api</span></span><br><span class="line">  <span class="comment"># TBH the 'retryOnRateLimit' would probably do the job better anyway</span></span><br><span class="line">  Sys.sleep(sleepPeriod)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Building-a-Word-Cloud"><a href="#Building-a-Word-Cloud" class="headerlink" title="Building a Word Cloud"></a>Building a Word Cloud</h2><h3 id="Which-Libraries"><a href="#Which-Libraries" class="headerlink" title="Which Libraries?"></a>Which Libraries?</h3><p>First we import a bunch of libraries that we will need.</p>
<ul>
<li><strong>tm</strong> and <strong>SnowballC</strong> for text mining and transformation</li>
<li><strong>RColorBrewer</strong> to pick a color palette</li>
<li><strong>wordcloud</strong> to plot the cloud itself</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(tm)</span><br><span class="line"><span class="keyword">library</span>(SnowballC)</span><br><span class="line"><span class="keyword">library</span>(wordcloud)</span><br><span class="line"><span class="keyword">library</span>(RColorBrewer)</span><br></pre></td></tr></table></figure>
<h3 id="Change-Encoding"><a href="#Change-Encoding" class="headerlink" title="Change Encoding"></a>Change Encoding</h3><p>We read in the data we collected in the last step. For some unknown reason the<br>data is coming back in an odd<br>encoding. We need to force it to UTF-8 to avoid the “tm” algorithms<br>crashing out half-way through.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data &lt;- read.csv(<span class="string">"7favegames.csv"</span>, row.names=<span class="literal">NULL</span>, stringsAsFactors = <span class="literal">FALSE</span>)</span><br><span class="line">tweets &lt;- data$text</span><br><span class="line">tweets &lt;- enc2utf8(tweets)</span><br></pre></td></tr></table></figure>
<h3 id="Convert-“Odd”-Characters-and-Numbers"><a href="#Convert-“Odd”-Characters-and-Numbers" class="headerlink" title="Convert “Odd” Characters and Numbers"></a>Convert “Odd” Characters and Numbers</h3><p>Many of the video game titles include roman numerals (e.g. Final<br>Fantasy X) or accented characters (e.g. Pokémon). We want to simplify<br>these down to a common form so we don’t end up with duplicates<br>(such as Pokémon vs Pokemon).</p>
<p>The roman numeral converter is pretty primitive but, I think, fine for this<br>purpose. <em>The odd ordering of the numbers is so that we’re greedy in<br>our matching of independent roman numerals (i.e. we don’t match a<br>substring of a numeral and corrupt the value).</em></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">replaceRoman &lt;- <span class="keyword">function</span>(vect) &#123;</span><br><span class="line">  numerals &lt;- c(<span class="string">"xviii"</span>, <span class="string">"xvii"</span>, <span class="string">"xiii"</span>, <span class="string">"viii"</span>, <span class="string">"xiv"</span>, <span class="string">"xvi"</span>, <span class="string">"xix"</span>, <span class="string">"vii"</span>, <span class="string">"iii"</span>, <span class="string">"xii"</span>, <span class="string">"ii"</span>, <span class="string">"iv"</span>, <span class="string">"vi"</span>, <span class="string">"ix"</span>, <span class="string">"xi"</span>, <span class="string">"xv"</span>, <span class="string">"xx"</span>, <span class="string">"i"</span>, <span class="string">"v"</span>, <span class="string">"x"</span>)</span><br><span class="line">  numbers &lt;- c(<span class="number">18</span>, <span class="number">17</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">19</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">10</span>)</span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> c(<span class="number">1</span>:length(numerals))) &#123;</span><br><span class="line">    vect &lt;- gsub(paste(<span class="string">"\\b"</span>, numerals[i], <span class="string">"\\b"</span>, sep=<span class="string">""</span>), numbers[i], vect)</span><br><span class="line">    vect &lt;- gsub(paste(<span class="string">"\\b"</span>, toupper(numerals[i]), <span class="string">"\\b"</span>, sep=<span class="string">""</span>), numbers[i], vect)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>(vect)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tweets &lt;- replaceRoman(tweets)</span><br><span class="line"><span class="comment"># remove accented characters</span></span><br><span class="line">tweets &lt;- iconv(tweets, to=<span class="string">'ASCII//TRANSLIT'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Perform-Corpus-Transformations"><a href="#Perform-Corpus-Transformations" class="headerlink" title="Perform Corpus Transformations"></a>Perform Corpus Transformations</h3><p>This is where the bulk of the transformations occur. We first create a<br>text corpus from our tweets and …</p>
<ul>
<li>Convert to lower case</li>
<li>Remove any punctuation</li>
<li>Remove stop words, such as <strong>“the”</strong> and <strong>“and”</strong>. Or those specific to tweets(<strong>“rt”</strong> and <strong>“lol”</strong>), and video games (e.g. <strong>“super”</strong> to avoid common words in all those SNES games).</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">corpus &lt;- Corpus(VectorSource(tweets))</span><br><span class="line">corpus &lt;- tm_map(corpus, content_transformer(tolower))</span><br><span class="line">corpus &lt;- tm_map(corpus, PlainTextDocument)</span><br><span class="line">corpus &lt;- tm_map(corpus, removePunctuation)</span><br><span class="line">corpus &lt;- tm_map(corpus, removeWords, c(<span class="string">"7favegames"</span>, <span class="string">"amp"</span>, <span class="string">"rt"</span>, <span class="string">"lol"</span>, <span class="string">"follow"</span>, <span class="string">"twitter"</span>, <span class="string">"series"</span>, <span class="string">"new"</span>, <span class="string">"super"</span>, stopwords(<span class="string">"english"</span>)))</span><br></pre></td></tr></table></figure>
<h3 id="Plot-Word-Cloud"><a href="#Plot-Word-Cloud" class="headerlink" title="Plot Word Cloud"></a>Plot Word Cloud</h3><p>Finally, now that we have our simplified corpus, we can plot our word<br>cloud.</p>
<p>We choose a fairly solid color scheme, avoiding too many of the weaker<br>shades that would be hard to read. You can see the full selection of palettes by running <em>display.brewer.all()</em></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># plot word cloud</span></span><br><span class="line">pal &lt;- brewer.pal(<span class="number">8</span>,<span class="string">"Dark2"</span>)</span><br><span class="line">wordcloud(corpus, max.words = <span class="number">200</span>, random.order=<span class="literal">TRUE</span>, scale=c(<span class="number">5</span>, <span class="number">.5</span>), colors = pal)</span><br></pre></td></tr></table></figure>
<h2 id="The-End-Result"><a href="#The-End-Result" class="headerlink" title="The End Result"></a>The End Result</h2><p>And here’s the end result:</p>
<p><img src="/images/7FaveGames_cloud.png" alt="7favegames Word Cloud"></p>
<p>Clearly Mario and Pokemon are the most popular - no real surprise there -<br>but it’s interesting to see other titles such as Dark Souls, Bioshock<br>and Bayonetta pop up. There are a couple of newer titles that make an appearance too, such as<br>Overwatch and Rocket League, but this may be partially due to some<br>kind of recency bias.</p>
<p>Admittedly the model does have some fundamental flaws though, including:</p>
<ul>
<li>Not accounting for the difference between a single game and<br>series. For example the Final Fantasy saga will get over-represented<br>due to the sheer number of releases.</li>
<li>Titles with more complicated names, or names prone to acronym, will<br>get under-represented due to the algorithm not being able to tie<br>those together.</li>
<li>Tweets that repeat a single game over and over will add unfairly to<br>its weight.</li>
</ul>
<p>But regardless, it’s a fun experiment to run, and does give us some<br>idea of the relative popularity of the various titles.</p>
<h2 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h2><ul>
<li><a href="https://github.com/lucas-matt/7FaveGames" target="_blank" rel="noopener">Github: Source Code &amp; Dataset</a></li>
<li><a href="http://www.kotaku.com.au/2016/08/our-7-fave-games/" target="_blank" rel="noopener">Kotaku: Our ‘7 Fave Games’</a></li>
<li><a href="https://uk.news.yahoo.com/7favegames-getting-twitter-users-nostalgic-145242961.html?nhp=1" target="_blank" rel="noopener">#7FaveGames is getting Twitter users nostalgic</a></li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://lucasmatt.com/2016/08/13/2016-08-13-7favegames/" data-id="cjhz4jgh70006g5r1zmj7afz3" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://lucasmatt.com/2016/08/13/2016-08-13-7favegames/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://lucasmatt.com/2016/08/13/2016-08-13-7favegames/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-2016-03-04-zero-downtime-upgrade-patterns" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/03/04/2016-03-04-zero-downtime-upgrade-patterns/">Zero Downtime Upgrade Problems and Patterns</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2016/03/04/2016-03-04-zero-downtime-upgrade-patterns/">
            <time datetime="2016-03-04T00:00:00.000Z" itemprop="datePublished">2016-03-04</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/DevOps/">DevOps</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/docker/">docker</a>, <a class="tag-link" href="/tags/linux/">linux</a>, <a class="tag-link" href="/tags/production/">production</a>, <a class="tag-link" href="/tags/upgrade/">upgrade</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/images/downtime.jpg" alt=""><br>In the modern software landscape it is increasingly important, even expected, that services be upgraded without causing downtime to the end user. In an industry such as IPTV to make the service unavailable to the end user for a period of time, even in the middle of the night, is generally unacceptable.</p>
<p>This page will survey the problems that various technologies face in this regard, and detail common patterns for tackling them.</p>
<p>This page will survey the problems that various technologies face in this regard, and detail common patterns for tackling them.</p>
<p>It’s worth noting here that most of these approaches are essentially just variations on the Blue Green Deployment strategy, as described by Martin Fowler <a href="http://martinfowler.com/bliki/BlueGreenDeployment.html" target="_blank" rel="noopener">here</a>.</p>
<h2 id="Stateless-Systems-Considering-Only-the-Application-Layer"><a href="#Stateless-Systems-Considering-Only-the-Application-Layer" class="headerlink" title="Stateless Systems / Considering Only the Application Layer"></a>Stateless Systems / Considering Only the Application Layer</h2><p>A stateless system, that is one without any kind of persistent store, is obviously the simplest case we can consider for a zero downtime upgrade and will cover many principles that can be used in all other cases, when considering the application in isolation.</p>
<h3 id="Remove-Upgrade-Add"><a href="#Remove-Upgrade-Add" class="headerlink" title="Remove-Upgrade-Add"></a>Remove-Upgrade-Add</h3><p>The most obvious strategy, and the one that is probably most widely used, is that of removing the service from a load balancer, upgrading that service, and once upgraded re-enabling it. Of course this assumes you have some redundancy in your platform to enable you to take parts of it down whilst still serving traffic.</p>
<p><img src="/images/remove-upgrade-add.gif" alt="Remove Add Upgrade Animation"></p>
<p>Unfortunately, this is a pretty coarse approach to upgrade, and is generally achieved manually by some poor engineer in the middle of the night. As manual is usually synonymous with bug-prone then automating this would be desirable, but isn’t trivial in a traditional bare-metal deployment as managing running services and state over potentially many nodes is quite tricky and bug-prone in itself.</p>
<h3 id="Fixing-the-Restart-Problem"><a href="#Fixing-the-Restart-Problem" class="headerlink" title="Fixing the Restart Problem"></a>Fixing the Restart Problem</h3><h4 id="Master-Workers-Model"><a href="#Master-Workers-Model" class="headerlink" title="Master - Workers Model"></a>Master - Workers Model</h4><p>World class http servers (e.g. nginx, unicorn) and process managers (e.g. node’s pm2) have inbuilt features that allow for zero-downtime upgrades within the context of a single machine, avoiding the tedium of the above remove-upgrade-add cycle but achieving the same end goal (remember we’re still talking application layer only, so no state to worry about).</p>
<p>The core architecture that allows them to achieve this is a master-workers model. In this model we have one core process performing all privileged operations (such as reading configuration or binding to ports) and a number of workers and helper processes (the app itself). The point here, is that this allows for the workers to be switched out behind the scenes, the master effectively working as a software load balancer.</p>
<blockquote>
<p><a href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/" target="_blank" rel="noopener">Inside Nginx - how we designed for performance/scale</a></p>
</blockquote>
<p><img src="/images/nginx-upgrade.png" alt="Nginx on the fly upgrade"></p>
<blockquote>
<p>“Nginx’s binary upgrade process achieves the holy grail of high-availability – you can upgrade the software on the fly, without any dropped connections, downtime, or interruption in service.</p>
</blockquote>
<blockquote>
<p>The binary upgrade process is similar in approach to the graceful reload of configuration. A new NGINX master process runs in parallel with the original master process, and they share the listening sockets. Both processes are active, and their respective worker processes handle traffic. You can then signal the old master and its workers to gracefully exit.”</p>
</blockquote>
<p>There are tools that are able to achieve this natively for your own project (the aforementioned pm2) and also as a generic solution across various platforms (<a href="https://github.com/zimbatm/socketmaster" target="_blank" rel="noopener">socketmaster</a>, <a href="https://github.com/stripe/einhorn" target="_blank" rel="noopener">einhorn</a>).</p>
<p>You could also achieve the equivalent of this architecture by parallel running both versions of your app on the same node, and using <strong>nginx reload</strong> to seamlessly switch your configuration between the two.</p>
<h3 id="so-reuseport"><a href="#so-reuseport" class="headerlink" title="so_reuseport"></a>so_reuseport</h3><p>Introduced in Linux kernel 3.9 was the SO_REUSEPORT option. As long as the first server sets this option before binding its socket, then any number of other servers can also bind to the same port if they also set the option beforehand - basically no more “Address already in use” errors. Once enabled the SO_REUSEPORT implementation will distribute connections evenly across all of the processes.</p>
<p><img src="/images/so_reuseport.png" width="500"></p>
<p>Of course, the implication here is that we can simply spin up multiple versions of our application, an old and new; drain the old of requests and once drained shut it down.</p>
<h2 id="Stateful-Systems-Evolving-the-Database"><a href="#Stateful-Systems-Evolving-the-Database" class="headerlink" title="Stateful Systems / Evolving the Database"></a>Stateful Systems / Evolving the Database</h2><p>It’s when we get to stateful systems that we begin to hit problems with zero downtime upgrades, or live migration. There is much to consider here, as we have various data-store properties and numerous different uses cases, especially in a micro-service model where each service is tuned in a very specific way. Inevitably most of the available patterns do not fit all circumstances.</p>
<p>First let’s consider the various dimensions along which this problem can vary:</p>
<p><strong>Mutability of Data</strong></p>
<ul>
<li>Read only systems - <em>metadata retrieval, or notification systems</em></li>
<li>Write only systems - <em>immutable data stores, event sourcing systems</em></li>
<li>Read-Write systems - <em>account management, bookmarking, etc</em></li>
</ul>
<p><strong>Data Store Properties</strong></p>
<ul>
<li>Schema based DB system - <em>Oracle, Cassandra</em></li>
<li>Schema-less - <em>MongoDB, Redis</em></li>
<li>Archive (essentially non-interactive) data store - <em>e.g. HDFS with Avro</em></li>
</ul>
<p><strong>Evolution Type</strong></p>
<ul>
<li>Addition of a field</li>
<li>Removal or rename of a field</li>
<li>Removal of a record</li>
<li>Refactoring of a record - <em>e.g. splitting into multiple</em></li>
</ul>
<h3 id="Polymorphic-Schema-Lazy-Migration"><a href="#Polymorphic-Schema-Lazy-Migration" class="headerlink" title="Polymorphic Schema / Lazy Migration"></a>Polymorphic Schema / Lazy Migration</h3><p>A schema-less database, such as MongoDB, can support a pattern known as a “Polymorphic Schema”, also known as a “single-table model”. Rather than all documents in a collection being identical, and so adhering to an implicit schema, the documents can be similar, but not identically structured. These schema, of course, map very closely to object-oriented programming principles. This style of schema feeds well into a schema evolution plan.</p>
<p><img src="/images/MongoDB-Applied-Design-Patterns.png" alt="MongoDB Applied Design Patterns"></p>
<p>A traditional RDBMS will evolve its schema through a set of migration scripts. When the system is live, these migrations can become complex or require database locking operations, resulting in periods of extended downtime. This model is also possible in Mongo DB, and similar, but we have alternatives that may suit us better.</p>
<p>By using a polymorphic schema we can account for the absence of a new field through defaults. Similar behavior can be implemented for field removal also, and these kinds of transformations are handled elegantly by Mongo ORM libraries if you want to avoid coding this logic yourself.</p>
<p>By applying these transformations lazily, as records are naturally read and written back to the database, the schema is slowly transformed into the latest. By running through all records in a collection, we would be able to force a full upgrade of the full collections.</p>
<p>Of course there are other, more specific, challenges depending on the type of transformation required:</p>
<ul>
<li><p>How do we perform collection refactoring exercises (e.g. splitting out a single collection into multiple related collections) - <em>would a _version field on an object allow us to trigger migrations more effectively in this case?</em></p>
</li>
<li><p>How would we perform queries based upon that new field? - <em>by forcing a read-write of all records, and therefore completing the transformation whilst the system was still alive?</em></p>
</li>
</ul>
<h3 id="Forward-Only-Migrations"><a href="#Forward-Only-Migrations" class="headerlink" title="Forward Only Migrations"></a>Forward Only Migrations</h3><p>For database systems that enforce a schema, but a principle that is equally as applicable to all persistence stores, is the concept of forward only migrations.</p>
<p><img src="/images/forward-migration.jpg" width="500"></p>
<p><strong>Never roll back == No messy recovery</strong></p>
<p>In this practice every database migration performed should be compatible with both the <strong>new</strong> version of the code <em>and</em> the <strong>previous</strong> one. Then if you have to roll back a code release the previous version is perfectly happy using the new version of the software.</p>
<p>As you can imagine, this will require some strict adherence to convention. For example, dropping a column:</p>
<p><strong>Dropping a Column</strong></p>
<ul>
<li>Release a version of the code that doesn’t use the column.</li>
<li>Ensure that it is stable, and won’t be rolled back.</li>
<li>Do a second release that has a migration to remove the column now that it isn’t being used.</li>
</ul>
<p><strong>Rename a Column</strong></p>
<ul>
<li>Release a version that adds a new column with the new name, changing the code to write to both but read from the old.</li>
<li>Employ a batch job to copy data from the old column to the new column - one row at a time to avoid locking the database.</li>
<li>Release a version that reads from and writes to the new column.</li>
<li>In the next release, drop the column</li>
</ul>
<p>This technique seems most successfully employed in a continuous delivery environment (<a href="http://engineering.skybettingandgaming.com/2016/02/02/how-we-release-so-frequently/" target="_blank" rel="noopener">I</a>)</p>
<h3 id="Expansion-Upgrade-Contraction-Scripts"><a href="#Expansion-Upgrade-Contraction-Scripts" class="headerlink" title="Expansion / Upgrade / Contraction Scripts"></a>Expansion / Upgrade / Contraction Scripts</h3><p>This method is similar to the last, but it’s organized slightly differently. Here we use two different sets of migration scripts:</p>
<p><strong>Expansion Scripts</strong></p>
<ul>
<li>Apply changes to the documents safely, that <strong>do not</strong> break backwards compatibility with the existing version of the application.</li>
<li>e.g. Adding, copying, merging splitting fields in a document.</li>
</ul>
<p><strong>Contraction Scripts</strong></p>
<ul>
<li>Clean up any database schema that is not needed after the upgrade.</li>
<li>e.g. removing fields from a document</li>
</ul>
<p><img src="/images/expand-contract.png" width="500"></p>
<p>The process we perform here is:</p>
<ol>
<li><strong>Expand</strong> - Run expansion scripts before upgrading the application</li>
<li><strong>Upgrade</strong> - Upgrade the cluster one node at a time</li>
<li><strong>Contract</strong> - Once the system has been completely upgraded and deemed stable. Typically, contractions can be run, say days/weeks after complete validation</li>
</ol>
<p>Again, this does not require any DB rollback. The reason for attempting this is that reversing DB changes can lead to potential loss of data or leaving your system in an inconsistent state. It is safer to rollback the application without needing to rollback DB changes as expansions are backwards compatible.</p>
<h3 id="One-Big-Caveat-for-the-Above"><a href="#One-Big-Caveat-for-the-Above" class="headerlink" title="One Big Caveat for the Above"></a>One Big Caveat for the Above</h3><p>Most of the above solutions require that upgrades are nice and discrete. That is, they move from version to version in an incremental way, not skipping any releases so that we can control schema compatibility in a pair-wise fashion.</p>
<p><img src="/images/incremental.png" width="400"></p>
<p>This is all fine for a continuous delivery, or cloud-based shop, where upgrades are obviously linear and wouldn’t be applied any other way. However what if you have a user-base of several parallel deployments all leap-frogging over various versions, as below.</p>
<p><img src="/images/bad_skip.png" width="400"></p>
<p>One solution is simply to enforce your upgrade path more clearly. So, for example, any app-only change would be a simple revision bump. But any schema change that needs to be handled by one of the above methods would be a larger bump.</p>
<p>It would have to be mandatory to hit every one of these larger version numbers to preserve this incremental schema-change model.</p>
<p><img src="/images/good_skip.png" width="400"></p>
<h2 id="Immutable-Infrastructure-Docker-and-Friends"><a href="#Immutable-Infrastructure-Docker-and-Friends" class="headerlink" title="Immutable Infrastructure - Docker and Friends"></a>Immutable Infrastructure - Docker and Friends</h2><p>In the world of containers, as deployments are immutable, then a number of the above techniques are not applicable. But the same blue-green principles apply.</p>
<p><img src="/images/docker_zdu.png" width="500"></p>
<p><a href="http://www.haproxy.org/" target="_blank" rel="noopener">HAProxy</a> is a web proxy and load balancer that allows you to change the configuration, restart the process, and (most importantly) have the old process die automatically when there is no more traffic running through it. So a simple upgrade would go as follows:</p>
<ul>
<li>Start a new version of the container</li>
<li>Tell HAProxy to direct all new traffic to the new container whilst maintaining existing connections to the previous.</li>
<li>All new users get access to the new code immediately, whilst existing users are not cut-off from their in-progress requests.</li>
</ul>
<p>Of course, this can all be automated, but that’s for another time.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="http://www.planetcassandra.org/blog/no-downtime-database-migrations/" target="_blank" rel="noopener">No Downtime Database Migrations</a></li>
<li><a href="http://martinfowler.com/bliki/BlueGreenDeployment.html" target="_blank" rel="noopener">Blue Green Deployment</a></li>
<li><a href="https://www.thoughtworks.com/insights/blog/implementing-blue-green-deployments-aws" target="_blank" rel="noopener">Implementing Blue-Green Deployments with AWS</a></li>
<li><a href="http://www.uswitch.com/tech/zero-downtime-clojure-deployments/" target="_blank" rel="noopener">Zero Downtime Clojure Deployments</a></li>
<li><a href="https://docs.quay.io/solution/zero-downtime-deployments.html" target="_blank" rel="noopener">Zero Downtime Deployments (in the context of Docker)</a></li>
<li><a href="http://kubernetes.io/v1.1/docs/user-guide/update-demo/README.html" target="_blank" rel="noopener">Kubernetes Rolling Update Example</a></li>
<li><a href="http://openmymind.net/Framework-Agnostic-Zero-Downtime-Deployment-With-Nginx/" target="_blank" rel="noopener">Framework Agnostic Zero Downtime Deployment with Nginx</a></li>
<li><a href="https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/" target="_blank" rel="noopener">Inside NGINX: How We Designed for Performance &amp; Scale</a></li>
<li><a href="http://www.ebaytechblog.com/2013/11/21/zero-downtime-instant-deployment-and-rollback/" target="_blank" rel="noopener">Zero Downtime, Instance Deployment and Rollback</a></li>
<li><a href="https://lwn.net/Articles/542629/" target="_blank" rel="noopener">The SO_REUSEPORT Socket Option</a></li>
<li><a href="http://engineering.skybettingandgaming.com/2016/02/02/how-we-release-so-frequently/" target="_blank" rel="noopener">How We Release So Frequently</a></li>
<li><a href="https://www.simple-talk.com/sql/database-administration/continuous-delivery-and-the-database/" target="_blank" rel="noopener">Continuous Delivery and the Database</a></li>
<li><a href="http://www.slideshare.net/DhavalDalal/midas-onthefly-schema-migration-tool-for-mongodb" target="_blank" rel="noopener">Midas On the Fly Migration Tool for Mongo DB</a></li>
<li><a href="http://doc.akka.io/docs/akka/snapshot/scala/persistence-schema-evolution.html" target="_blank" rel="noopener">Akka Persistence - Schema Evolution</a></li>
<li><a href="http://shop.oreilly.com/product/0636920027041.do" target="_blank" rel="noopener">MongoDB Applied Design Patterns [Book]</a></li>
<li><a href="https://blog.justjuzzy.com/2012/11/migrate-your-database-upon-deployments/" target="_blank" rel="noopener">Migrating Your Database Upon Deployments</a></li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://lucasmatt.com/2016/03/04/2016-03-04-zero-downtime-upgrade-patterns/" data-id="cjhz4jgh00002g5r1d8na8ynf" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://lucasmatt.com/2016/03/04/2016-03-04-zero-downtime-upgrade-patterns/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://lucasmatt.com/2016/03/04/2016-03-04-zero-downtime-upgrade-patterns/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-2016-08-05-survivorship-bias" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2016/03/04/2016-08-05-survivorship-bias/">Survivorship Bias and Negotiating Tech Hype</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2016/03/04/2016-08-05-survivorship-bias/">
            <time datetime="2016-03-04T00:00:00.000Z" itemprop="datePublished">2016-03-04</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/Thoughts/">Thoughts</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/development/">development</a>, <a class="tag-link" href="/tags/statistics/">statistics</a>, <a class="tag-link" href="/tags/thinking/">thinking</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/images/whaam.jpg" alt=""></p>
<h2 id="Bombers-with-Bullet-Holes"><a href="#Bombers-with-Bullet-Holes" class="headerlink" title="Bombers with Bullet Holes"></a>Bombers with Bullet Holes</h2><p>During the dark days of World War II the American military presented<br>their Statistical Research Group with a problem. They wanted to add additional armour to<br>their bombers, but clearly couldn’t put the armour everywhere because<br>of the additional weight it would add to the planes. The group was<br>tasked with working out how much armor to allocate to the various regions<br>of the aircraft to maximize defense whilst minimizing any effect on<br>fuel consumption and agility.</p>
<p>Engineers inspected a number of bombers that had seen some action. These<br>planes had bullet holes that were distributed mainly across the wings<br>and body. Comparatively the engines and cockpit had much less<br>damage. This had lead the commanders to make the obvious, but foolish, conclusion that<br>they should enhance armour on areas that had been hit most<br>frequently, namely the fuselage and wings. </p>
<p>One of the many geniuses of the group, Abraham Wald, realised that they<br>were looking at the problem from completely the wrong angle. It’s not<br>that planes weren’t being hit as frequently on the engines and cockpit,<br>but rather those that had been never returned to tell the tale! These<br>were the parts of the airplane that needed enhancement, not the areas<br>that could take a battering and still survive.</p>
<h2 id="Survivorship-Bias"><a href="#Survivorship-Bias" class="headerlink" title="Survivorship Bias"></a>Survivorship Bias</h2><p>How do you really evaluate a success when the failures are nowhere<br>to be seen?</p>
<p><img src="/images/survive.jpg" alt="Survive"></p>
<p>Countless articles, books and documentaries have been produced about<br>successful people and how to capture the principles of their success to<br>improve your own fortune.</p>
<p>Consider Steve Jobs - frequently heralded as a one of the greatest<br>geniuses of our time - how do we emulate his success? Clearly dropping<br>out of college, spending time at meditation retreats and starting a<br>business from your parent’s garage is the way to go. But what about<br>the hundreds of thousands of budding Apple founders for whom this<br>strategy never quite worked out?</p>
<p>Books aren’t usually written about failed enterprises,<br>just the rare, billion-dollar, success stories.</p>
<h2 id="Choosing-Tech-Thoughtfully"><a href="#Choosing-Tech-Thoughtfully" class="headerlink" title="Choosing Tech Thoughtfully"></a>Choosing Tech Thoughtfully</h2><p>As well as being responsible for the latest diet fads and the exaggerated<br>performance of mutual funds, we can see this<br>bias lurking in certain corners of the software development world.</p>
<p><img src="/images/homer_thought.jpg" alt="Thinking"></p>
<p>How often do you see a wave of enthusiasm for the next high<br>throughput NoSQL<br>system or a push for complicated elastic scaling technology? Companies<br>such as Twitter and Netflix present their wild successes but we don’t usually see qualifications on the size and<br>scale of the teams implementing these solutions.</p>
<p>It’s worth keeping in<br>mind the potential for a mass of silent teams. Struggling under the<br>weight of overpowered, over-engineered, “web-scale” technologies<br>inspired by the industry front-runners. Most of us mere mortals just don’t<br>have the resources, skills, or (most importantly) even the need for<br>such high class deployments. Most of the time it’s just better to keep<br>things simple and known.</p>
<p>Similarly, businesses push on with “Big Data” for fear of missing<br>out, but without any real understanding of what they really<br>need. Solutions are commissioned that aspire to the heights of Facebook and Google<br>whilst in reality they fumble for a real business-value providing use-case.</p>
<p>Don’t get me wrong, I’m 100% all for learning new paradigms, languages<br>and frameworks. This is just a reminder, as much to myself as anyone<br>else, to take a moment to think past the biases that may lead us to<br>make some regrettable, albeit well-intentioned and over-excited, choices.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://youarenotsosmart.com/2013/05/23/survivorship-bias/" target="_blank" rel="noopener">You Are Not So<br>Smart</a></li>
<li><a href="https://www.amazon.co.uk/dp/071819604X" target="_blank" rel="noopener">How Not to Be Wrong: The Hidden Maths of Everyday Life</a></li>
<li><a href="https://www.thoughtworks.com/radar/techniques/high-performance-envy-web-scale-envy" target="_blank" rel="noopener">High performance envy/web scale envy</a></li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://lucasmatt.com/2016/03/04/2016-08-05-survivorship-bias/" data-id="cjhz4jghc0009g5r1kg2tija0" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://lucasmatt.com/2016/03/04/2016-08-05-survivorship-bias/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://lucasmatt.com/2016/03/04/2016-08-05-survivorship-bias/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-2015-06-01-augeas-the-missing-manual" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2015/06/01/2015-06-01-augeas-the-missing-manual/">Augeas the Missing Manual</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2015/06/01/2015-06-01-augeas-the-missing-manual/">
            <time datetime="2015-06-01T00:00:00.000Z" itemprop="datePublished">2015-06-01</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/DevOps/">DevOps</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/augeas/">augeas</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="/images/augeas.jpg" alt=""></p>
<p>Lately I’ve been using Augeas to configure some json files, and phew! it’s not been easy! So here’s a little guide to help other unfortunate souls lost in the Augeas wilderness.</p>
<p>1) First let’s start with a pretty basic json file located at <strong>/tmp/test.json</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">"a"</span>: <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure>
<p>2) <strong>Load</strong></p>
<p>   Loading the file with the json lens is easy enough once you know how<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">augtool&gt; set /augeas/load/Json/lens Json.lns</span><br><span class="line">augtool&gt; set /augeas/load/Json/incl /tmp/test.json</span><br><span class="line">augtool&gt; load</span><br><span class="line">augtool&gt; print /files/tmp/test.json</span><br><span class="line"></span><br><span class="line">/files/tmp/test.json</span><br><span class="line">/files/tmp/test.json/dict</span><br><span class="line">/files/tmp/test.json/dict/entry = &quot;a&quot;</span><br><span class="line">/files/tmp/test.json/dict/entry/number = &quot;1&quot;</span><br></pre></td></tr></table></figure><br>3) <strong>Set</strong></p>
<p>   As is changing the existing property<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">augtool&gt; set /files/tmp/test.json/dict/entry[. = &quot;a&quot;]/number 2</span><br><span class="line">augtool&gt; save</span><br><span class="line">Saved 1 file(s)</span><br></pre></td></tr></table></figure><br>  resulting in<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">"a"</span> : <span class="number">2</span> &#125;</span><br></pre></td></tr></table></figure><br>4) <strong>Set Type</strong></p>
<p>   Of course you can change this to a string or boolean property as required<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">augtool&gt; rm /files/tmp/test.json/dict/entry[. = &quot;a&quot;]/number</span><br><span class="line">augtool&gt; set /files/tmp/test.json/dict/entry[. = &quot;a&quot;]/string hello</span><br><span class="line">augtool&gt; save</span><br><span class="line">Saved 1 files(s)</span><br></pre></td></tr></table></figure><br>   to create<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">"a"</span>: <span class="string">"hello"</span> &#125;</span><br></pre></td></tr></table></figure><br>5) <strong>Add Sub-object</strong></p>
<p>   And finally adding some subobjects with properties<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set /files/tmp/test.json/dict/entry[. = &quot;b&quot;] b</span><br><span class="line">set /files/tmp/test.json/dict/entry[. = &quot;b&quot;]/dict/entry[. = &quot;c&quot;] c</span><br><span class="line">set /files/tmp/test.json/dict/entry[. = &quot;b&quot;]/dict/entry[. = &quot;c&quot;]/dict/entry[. = &quot;d&quot;] d</span><br><span class="line">set /files/tmp/test.json/dict/entry[. = &quot;b&quot;]/dict/entry[. = &quot;c&quot;]/dict/entry[. = &quot;d&quot;]/string &quot;world&quot;</span><br><span class="line">augtool&gt; save</span><br><span class="line">Saved 1 files(s)</span><br></pre></td></tr></table></figure><br>   to create an json structure with depth:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;a&quot;: &quot;hello&quot;,</span><br><span class="line">    &quot;b&quot;: &#123;</span><br><span class="line">        &quot;c&quot;: &#123;</span><br><span class="line">            &quot;d&quot;: &quot;world&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://lucasmatt.com/2015/06/01/2015-06-01-augeas-the-missing-manual/" data-id="cjhz4jggr0000g5r1a5dxfqk3" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://lucasmatt.com/2015/06/01/2015-06-01-augeas-the-missing-manual/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://lucasmatt.com/2015/06/01/2015-06-01-augeas-the-missing-manual/">Comments</a>
    

        </footer>
    </div>
    
</article>


</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/03/13/testing-nightmares/" class="thumbnail">
    
    
        <span style="background-image:url(/images/nightmare.jpg)" alt="6(66) Nightmares of Microservice Testing" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Testing/">Testing</a></p>
                            <p class="item-title"><a href="/2018/03/13/testing-nightmares/" class="title">6(66) Nightmares of Microservice Testing</a></p>
                            <p class="item-date"><time datetime="2018-03-13T19:35:18.000Z" itemprop="datePublished">2018-03-13</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/02/17/bits-2017-02-18/" class="thumbnail">
    
    
        <span style="background-image:url(/images/flat_bits_thumb.jpg)" alt="[Bits 1] Year of the Dog" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/bits/">bits</a></p>
                            <p class="item-title"><a href="/2018/02/17/bits-2017-02-18/" class="title">[Bits 1] Year of the Dog</a></p>
                            <p class="item-date"><time datetime="2018-02-17T00:00:00.000Z" itemprop="datePublished">2018-02-17</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/01/01/radar-jan-18/" class="thumbnail">
    
    
        <span style="background-image:url(/images/radar-jan-18/firework.jpg)" alt="Technology Radar Jan &#39;18" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Tech-Radar/">Tech Radar</a></p>
                            <p class="item-title"><a href="/2018/01/01/radar-jan-18/" class="title">Technology Radar Jan &#39;18</a></p>
                            <p class="item-date"><time datetime="2018-01-01T00:00:00.000Z" itemprop="datePublished">2018-01-01</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/08/22/spring-microservices/" class="thumbnail">
    
    
        <span style="background-image:url(/images/spring-microservices/spring.jpg)" alt="Spring Cloud in 10 Bad Cartoons" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Programming/">Programming</a></p>
                            <p class="item-title"><a href="/2017/08/22/spring-microservices/" class="title">Spring Cloud in 10 Bad Cartoons</a></p>
                            <p class="item-date"><time datetime="2017-08-22T00:00:00.000Z" itemprop="datePublished">2017-08-22</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/08/13/python-async/" class="thumbnail">
    
    
        <span style="background-image:url(/images/python-async/python.jpg)" alt="Python 3 Asyncio" class="thumbnail-image"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Programming/">Programming</a></p>
                            <p class="item-title"><a href="/2017/08/13/python-async/" class="title">Python 3 Asyncio</a></p>
                            <p class="item-date"><time datetime="2017-08-13T00:00:00.000Z" itemprop="datePublished">2017-08-13</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/">Architecture</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Data-Science/">Data Science</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevOps/">DevOps</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Development/">Development</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Programming/">Programming</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech-Radar/">Tech Radar</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Testing/">Testing</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Thoughts/">Thoughts</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/bits/">bits</a><span class="category-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/async/" style="font-size: 10px;">async</a> <a href="/tags/augeas/" style="font-size: 10px;">augeas</a> <a href="/tags/bits/" style="font-size: 10px;">bits</a> <a href="/tags/data-science/" style="font-size: 10px;">data science</a> <a href="/tags/development/" style="font-size: 10px;">development</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/growth/" style="font-size: 10px;">growth</a> <a href="/tags/intellij/" style="font-size: 10px;">intellij</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/microservices/" style="font-size: 20px;">microservices</a> <a href="/tags/production/" style="font-size: 10px;">production</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/radar/" style="font-size: 10px;">radar</a> <a href="/tags/spring/" style="font-size: 10px;">spring</a> <a href="/tags/statistics/" style="font-size: 15px;">statistics</a> <a href="/tags/testing/" style="font-size: 10px;">testing</a> <a href="/tags/thinking/" style="font-size: 15px;">thinking</a> <a href="/tags/upgrade/" style="font-size: 10px;">upgrade</a> <a href="/tags/vagrant/" style="font-size: 10px;">vagrant</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="https://www.linkedin.com/in/lucas-matt/">linkedin</a>
                    </li>
                
                    <li>
                        <a href="https://twitter.com/NotMattLucas">twitter</a>
                    </li>
                
                    <li>
                        <a href="https://github.com/lucas-matt">github</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fas fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2018 Matt Lucas<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_config = function () {
        
        this.page.identifier = 'undefined';
    };
    (function() { 
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'lucasmatt.com' + '.disqus.com/count.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>